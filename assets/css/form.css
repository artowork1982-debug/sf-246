/* ===== KUVAN UPLOAD LOADING ===== */
.sf-upload-loading {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border-radius: inherit;
    z-index: 20;
}

.sf-upload-spinner {
    width: 32px;
    height: 32px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: sf-upload-spin 0.8s linear infinite;
}

@keyframes sf-upload-spin {
    to {
        transform: rotate(360deg);
    }
}

.sf-upload-text {
    color: white;
    font-size: 12px;
    font-weight: 600;
}

.sf-upload-success {
    color: #22c55e;
    font-size: 32px;
    font-weight: 700;
}

.sf-upload-error {
    color: #ef4444;
    font-size: 14px;
    font-weight: 600;
}

/* ===== SUPERVISOR APPROVAL MESSAGES ===== */
.loading-message {
    color: #6b7280;
    font-style: italic;
    padding: 8px;
    margin: 4px 0;
    font-size: 14px;
}

.error-message {
    color: #dc2626;
    background: #fee;
    padding: 8px;
    border-radius: 4px;
    margin: 4px 0;
    font-size: 14px;
}

.no-approvers-message {
    color: #6b7280;
    font-style: italic;
    padding: 8px;
    margin: 4px 0;
    font-size: 14px;
}

/* ===== PERUS RESET ===== */
html,
body {
    margin: 0;
    padding: 0;
}

/* ===== MOBIILI ===== */
@media (max-width: 768px) {

    .sf-form {
        margin: 0;
        padding: 16px;
        /* Form starts below progress bar (80px) */
        margin-top: var(--sf-form-margin-top-mobile);
        padding-bottom: 16px;
        border-radius: 0;
        border-left: none;
        border-right: none;
        /* border-top remains for type color */
        box-shadow: none;
        background: #ffffff;
        max-width: 100%;
        position: relative;
    }

    .sf-step-content {
        padding: 0;
        padding-bottom: 16px;
    }

    /* Progress bar - outside form on dark background */
    .sf-form-progress,
    .sf-progress {
        position: fixed;
        top: calc(var(--sf-nav-height-mobile) + 16px);
        /* Below nav with spacing */
        left: 0;
        right: 0;
        z-index: 1000;
        background: transparent;
        /* No background - dark body shows through */
        margin: 0;
        padding: 12px 16px;
        border-bottom: none;
        box-shadow: none;
        transform: none;
        /* Remove the translateY */
    }

    .sf-form-progress__number {
        width: 28px;
        height: 28px;
        font-size: 11px;
    }

    .sf-form-progress__label {
        display: none;
    }

    /* Hide progress track line on mobile */
    .sf-form-progress__track,
    .sf-progress-track {
        display: none;
    }

    /* Language selection - compact */
    .sf-lang-options {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .sf-lang-box {
        padding: 8px 12px;
        flex: 0 0 auto;
    }

    .sf-lang-flag {
        width: 20px;
        height: 20px;
    }

    .sf-lang-label {
        font-size: 13px;
    }

    /* Mobile action buttons - natural flow at bottom of content */
    .sf-step-actions,
    .sf-step-actions-bottom {
        position: static;
        margin: 16px 0 0 0;
        padding: 0;
        background: transparent;
        display: flex;
        gap: 12px;
        border: none;
        box-shadow: none;
        border-radius: 0;
    }

    /* All buttons in action bar */
    .sf-step-actions .sf-btn,
    .sf-step-actions-bottom .sf-btn,
    .sf-step-actions button,
    .sf-step-actions-bottom button {
        flex: 1;
        border-radius: 8px;
        margin: 0;
        min-height: 52px;
        font-size: 15px;
        font-weight: 600;
    }

    /* Remove active transform animation on mobile for cleaner touch interaction */
    .sf-step-actions .sf-btn:active,
    .sf-step-actions-bottom .sf-btn:active,
    .sf-step-actions button:active,
    .sf-step-actions-bottom button:active {
        transform: none;
    }

    /* Also disable hover transform on mobile */
    .sf-step-actions .sf-btn:hover,
    .sf-step-actions-bottom .sf-btn:hover,
    .sf-step-actions button:hover,
    .sf-step-actions-bottom button:hover {
        transform: none;
    }

    /* Previous/Secondary buttons - gray */
    .sf-step-actions .sf-btn-secondary,
    .sf-step-actions-bottom .sf-btn-secondary,
    .sf-step-actions .sf-prev-btn,
    .sf-step-actions-bottom .sf-prev-btn {
        background: var(--sf-gray-light, #e5e7eb);
        color: var(--sf-gray-dark, #374151);
        border: none;
    }

    .sf-step-actions .sf-btn-secondary:hover,
    .sf-step-actions-bottom .sf-btn-secondary:hover,
    .sf-step-actions .sf-prev-btn:hover,
    .sf-step-actions-bottom .sf-prev-btn:hover {
        background: var(--sf-gray-hover, #d1d5db);
    }

    /* Next/Primary buttons - blue */
    .sf-step-actions .sf-btn-primary,
    .sf-step-actions-bottom .sf-btn-primary,
    .sf-step-actions .sf-next-btn,
    .sf-step-actions-bottom .sf-next-btn {
        background: var(--sf-blue-primary, #2563eb);
        color: #ffffff;
        border: none;
    }

    .sf-step-actions .sf-btn-primary:hover,
    .sf-step-actions-bottom .sf-btn-primary:hover,
    .sf-step-actions .sf-next-btn:hover,
    .sf-step-actions-bottom .sf-next-btn:hover {
        background: var(--sf-blue-hover, #1d4ed8);
    }

    /* Single button takes full width */
    .sf-step-actions .sf-btn:only-child,
    .sf-step-actions-bottom .sf-btn:only-child {
        flex: 1;
        width: 100%;
    }
}

@media (max-width: 480px) {

    .sf-form {
        /* Form starts below progress bar */
        margin-top: var(--sf-form-margin-top-small);
        padding-bottom: 16px;
    }
}

/* ===== DESKTOP LOMAKE ===== */
.sf-form,
.sf-form-page,
.sf-page-form {
    max-width: var(--sf-container-md);
    margin: var(--sf-spacing-page) auto var(--sf-spacing-large);
    padding: 32px;
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    font-family: "Open Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    box-sizing: border-box;
    border: 1px solid #e5e7eb;
    border-top-width: 10px;
    --sf-accent-color: #9ca3af;
    --sf-yellow: #FEE000;
    --sf-black: #0f172a;
    --sf-blue-primary: #2563eb;
    --sf-blue-hover: #1d4ed8;
    --sf-gray-light: #e5e7eb;
    --sf-gray-hover: #d1d5db;
    --sf-gray-dark: #374151;
    /* Mobile layout spacing (768px) */
    --sf-nav-height-mobile: 44px;
    --sf-actions-height-mobile: 52px;
    --sf-footer-height-mobile: 70px;
    /* Updated for new footer height */
    --sf-form-margin-top-mobile: 80px;
    /* Space for fixed progress bar */
    /* Mobile layout spacing (480px) */
    --sf-nav-height-small: 40px;
    --sf-actions-height-small: 50px;
    --sf-footer-height-small: 70px;
    /* Updated for new footer height */
    --sf-form-margin-top-small: 75px;
    /* Space for fixed progress bar on smaller screens */
    border-top-color: var(--sf-accent-color);
    transition: border-top-color 0.25s ease;
}

@media (min-width: 769px) {
    .sf-form {
        margin: 24px auto;
        padding: 32px;
        border-radius: 16px;
    }
}

@media (max-width: 768px) {
    .sf-form {
        margin: 12px;
        padding: 20px 16px;
        border-radius: 12px;
    }
}

/* Form wizard container */
.sf-form-wizard {
    max-width: var(--sf-container-md);
    margin: 0 auto;
}

/* Steps indicator */
.sf-steps {
    max-width: var(--sf-container-md);
    margin: 0 auto 32px;
}

/* Tyyppikohtaiset värit */
.sf-form.type-red {
    --sf-accent-color: #ef4444;
}

.sf-form.type-yellow {
    --sf-accent-color: #eab308;
}

.sf-form.type-green {
    --sf-accent-color: #22c55e;
}

/* Piilotusluokka */
.hidden {
    display: none !important;
}

/* Otsikot vaiheille */
.sf-step-content h2 {
    font-size: 22px;
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 20px;
}

.sf-step-content h3 {
    font-size: 16px;
    font-weight: 600;
    color: #374151;
    margin: 24px 0 12px;
}

/* Pieni seliteteksti */
.sf-help-text {
    font-size: 13px;
    color: #6b7280;
    margin-top: 8px;
}

.sf-divider {
    border: none;
    border-top: 1px solid #e5e7eb;
    margin: 24px 0;
}

.sf-label {
    font-size: 14px;
    font-weight: 500;
    color: #374151;
    margin-bottom: 8px;
    display: block;
}

/* --- TYYPPI-VALINTA (VAIHE 1) --- */

.sf-type-selection {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin: 20px 0;
}

/* Tablet - 3 side by side */
@media (max-width: 1024px) {
    .sf-type-selection {
        gap: 12px;
    }
}

/* Mobile - stacked */
@media (max-width: 640px) {
    .sf-type-selection {
        grid-template-columns: 1fr;
        gap: 12px;
    }
}

.sf-type-box {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: #ffffff;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    min-height: 90px;
}

/* Väripalkki vasemmassa reunassa */
.sf-type-box::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    border-radius: 12px 0 0 12px;
}

.sf-type-box[data-type="red"]::before {
    background: #ef4444;
}

.sf-type-box[data-type="yellow"]::before {
    background: #eab308;
}

.sf-type-box[data-type="green"]::before {
    background: #22c55e;
}

/* Hover */
.sf-type-box:hover {
    border-color: #d1d5db;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

/* Valittu tila */
.sf-type-box.selected,
.sf-type-box:has(input:checked) {
    border-width: 2px;
}

.sf-type-box[data-type="red"].selected,
.sf-type-box[data-type="red"]:has(input:checked) {
    border-color: #ef4444;
    background: #fef2f2;
}

.sf-type-box[data-type="yellow"].selected,
.sf-type-box[data-type="yellow"]:has(input:checked) {
    border-color: #eab308;
    background: #fefce8;
}

.sf-type-box[data-type="green"].selected,
.sf-type-box[data-type="green"]:has(input:checked) {
    border-color: #22c55e;
    background: #f0fdf4;
}

/* Piilota radio input */
.sf-type-box input[type="radio"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
}

/* Sisältö layout */
.sf-type-box-content {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    padding-left: 8px;
}

/* Ikoni */
.sf-type-icon {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
}

/* Teksti */
.sf-type-text {
    flex: 1;
    min-width: 0;
}

.sf-type-title {
    font-size: 15px;
    font-weight: 600;
    color: #0f172a;
    margin: 0 0 2px 0;
}

.sf-type-text p {
    font-size: 12px;
    color: #6b7280;
    margin: 0;
    line-height: 1.3;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
}

/* Checkmark oikeassa yläkulmassa */
.sf-type-checkmark {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 22px;
    height: 22px;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.sf-type-box.selected .sf-type-checkmark,
.sf-type-box:has(input:checked) .sf-type-checkmark {
    opacity: 1;
}

/* Mobiili - pystysuunta */
@media (max-width: 768px) {
    .sf-type-selection {
        grid-template-columns: 1fr;
        gap: 10px;
        margin: 12px 0;
    }

    .sf-type-box {
        padding: 12px 14px;
        min-height: 70px;
    }

    .sf-type-icon {
        width: 44px;
        height: 44px;
    }

    .sf-type-title {
        font-size: 14px;
    }

    .sf-type-text p {
        font-size: 11px;
        -webkit-line-clamp: 2;
    }
}

/* --- PÄIVÄMÄÄRÄKENTTÄ --- */
input[type="datetime-local"],
input[type="date"],
input[type="time"] {
    cursor: pointer;
    position: relative;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

input[type="datetime-local"]::-webkit-calendar-picker-indicator,
input[type="date"]::-webkit-calendar-picker-indicator,
input[type="time"]::-webkit-calendar-picker-indicator {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
    background: transparent;
}

.sf-field:has(input[type="datetime-local"]),
.sf-field:has(input[type="date"]),
.sf-field:has(input[type="time"]) {
    position: relative;
}

.sf-field:has(input[type="datetime-local"])::after,
.sf-field:has(input[type="date"])::after {
    content: "";
    position: absolute;
    right: 14px;
    top: calc(22px + 28px);
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    background-image: url('../img/icons/calendar.svg');
    background-size: contain;
    background-repeat: no-repeat;
    pointer-events: none;
    opacity: 0.6;
}

.sf-field:has(input[type="time"])::after {
    content: "";
    position: absolute;
    right: 14px;
    top: calc(22px + 28px);
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    background-image: url('../img/icons/clock.svg');
    background-size: contain;
    background-repeat: no-repeat;
    pointer-events: none;
    opacity: 0.6;
}

input[type="datetime-local"]:hover,
input[type="date"]:hover,
input[type="time"]:hover {
    border-color: #9ca3af;
    background-color: #f9fafb;
}

/* Pieni näyttö */
@media (max-width: 400px) {
    .sf-type-box {
        padding: 12px;
        gap: 10px;
    }

    .sf-type-icon {
        width: 40px;
        height: 40px;
    }

    .sf-type-title {
        font-size: 14px;
    }

    .sf-type-text p {
        font-size: 11px;
    }

    .sf-type-checkmark {
        width: 20px;
        height: 20px;
        right: 8px;
    }
}

/* --- KENTTÄRIVIT JA INPUTIT --- */

.sf-field-row {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    margin-top: 8px;
    margin-bottom: 8px;
}

.sf-field {
    flex: 1 1 220px;
    min-width: 220px;
    margin-bottom: 1rem;
}

.sf-label {
    display: block;
    font-size: 0.9rem;
    font-weight: 600;
    color: #0f172a;
    margin-bottom: 6px;
}

.sf-input,
.sf-select,
.sf-textarea {
    width: 100%;
    min-height: 44px;
    padding: 10px 12px;
    font-size: 1rem;
    line-height: 1.4;
    border-radius: 12px;
    border: 1px solid #d1d5db;
    background-color: #f9fafb;
    color: #111827;
    box-sizing: border-box;
    transition: border-color 0.15s ease, box-shadow 0.15s ease, background-color 0.15s ease;
}

.sf-textarea {
    min-height: 120px;
    resize: vertical;
}

/* Short description textarea - compact height */
#sf-short-text {
    min-height: 48px;
    max-height: 80px;
    resize: none;
}

.sf-input:focus,
.sf-select:focus,
.sf-textarea:focus {
    outline: none;
    background-color: #ffffff;
    box-shadow: 0 0 0 1px rgba(17, 24, 39, 0.15);
}

.sf-select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-position: right 12px center;
    background-repeat: no-repeat;
}

/* --- VAIHEET --- */

.sf-step2-section {
    margin-top: 10px;
}

/* --- NAPPIRIVI JA PAINIKKEET --- */

.sf-step-actions,
.sf-step-actions-bottom {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    margin-top: 32px;
    padding-top: 24px;
    border-top: none;
}

.sf-step-actions button,
.sf-step-actions-bottom button {
    padding: 14px 32px;
    font-size: 15px;
    font-weight: 600;
    border-radius: 10px;
    transition: all 0.2s ease;
}

.sf-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.35rem;
    padding: 0.75rem 1.7rem;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    transition: background-color 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
}

.sf-btn-primary {
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    color: #fff;
    border: none;
}

.sf-btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
}

.sf-btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #e5e7eb;
}

.sf-btn-secondary:hover {
    background: #e5e7eb;
}

/* Disabled nappi */
.sf-btn-primary:disabled,
.sf-btn-primary.disabled {
    background-color: #d1d5db;
    color: #9ca3af;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
}

.sf-btn-primary:disabled:hover,
.sf-btn-primary.disabled:hover {
    background-color: #d1d5db;
    transform: none;
    box-shadow: none;
}

/* --- PROGRESSBAR --- */

.sf-progress {
    margin: -10px 0 24px;
    padding-top: 6px;
    text-align: center;
    overflow-x: hidden;
    /* Prevent horizontal overflow */
}

.sf-progress-track {
    width: 100%;
    height: 8px;
    background: linear-gradient(90deg, #e5e7eb 0%, #f3f4f6 100%);
    border-radius: 999px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
}

.sf-progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--sf-black) 0%, #1e293b 50%, var(--sf-black) 100%);
    border-radius: 999px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(15, 23, 42, 0.3);
    position: relative;
    overflow: hidden;
    max-width: 100%;
    /* Prevent overflow */
}

.sf-progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(254, 224, 0, 0.3) 50%, transparent 100%);
    animation: sf-progress-nav-shimmer 2s ease-in-out infinite;
}

@keyframes sf-progress-nav-shimmer {
    0% {
        transform: translateX(-100%);
    }

    100% {
        transform: translateX(100%);
    }
}

.sf-progress-steps {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    color: #000000;
    max-width: 100%;
    /* Prevent overflow */
    overflow: hidden;
}

.sf-progress-steps span {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: #fff;
    border: 2px solid #000;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.25s ease;
}

.sf-progress-steps span.active {
    background: #000000;
    color: #ffffff;
    border-color: #000000;
    transform: scale(1.05);
}

/* --- VAIHEET --- */

.sf-step-content {
    display: none;
}

.sf-step-content.active {
    display: block;
}

/* --- KUVAUPLOAD --- */

.sf-upload-row {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    margin-top: 16px;
}

.sf-upload-slot {
    flex: 1 1 0;
    min-width: 0;
    background: transparent;
    border: none;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.sf-upload-slot-label {
    font-weight: 600;
    font-size: 0.85rem;
    color: #374151;
    margin-bottom: 4px;
}

.sf-upload-slot input[type="file"] {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

.sf-upload-preview {
    margin-top: 6px;
    background: #f3f4f6;
    border-radius: 12px;
    height: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
    cursor: pointer;
    border: 2px dashed #d1d5db;
    transition: border-color 0.2s ease, background-color 0.2s ease, transform 0.15s ease;
}

.sf-upload-preview:hover {
    border-color: #9ca3af;
    background-color: #e5e7eb;
    transform: scale(1.02);
}

.sf-upload-preview:focus-within {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
}

.sf-upload-preview.has-image {
    border-style: solid;
    border-color: #d1d5db;
}

.sf-upload-preview.has-image:hover {
    border-color: #9ca3af;
}

.sf-upload-preview img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: opacity 0.2s ease;
}

.sf-upload-preview img[src*="camera-placeholder"] {
    width: 64px;
    height: 64px;
    object-fit: contain;
    opacity: 0.4;
}

.sf-upload-preview:hover img[src*="camera-placeholder"] {
    opacity: 0.6;
}

.sf-upload-preview::after {
    content: "Lisää kuva";
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8rem;
    color: #6b7280;
    font-weight: 500;
    opacity: 0;
    transition: opacity 0.2s ease;
    pointer-events: none;
}

.sf-upload-preview:hover::after {
    opacity: 1;
}

.sf-upload-preview.has-image::after {
    display: none;
}

.sf-upload-remove {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: rgba(0, 0, 0, 0.7);
    color: #fff;
    font-size: 22px;
    line-height: 1;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 0;
    z-index: 10;
    transition: background-color 0.2s ease, transform 0.15s ease;
}

.sf-upload-preview.has-image .sf-upload-remove {
    display: flex;
}

.sf-upload-remove:hover {
    background: rgba(220, 38, 38, 0.9);
    transform: scale(1.1);
}

@media (max-width: 900px) {
    .sf-upload-row {
        flex-direction: column;
    }

    .sf-upload-preview {
        height: 120px;
        border-radius: 14px;
    }

    .sf-upload-preview img[src*="camera-placeholder"] {
        width: 56px;
        height: 56px;
    }

    .sf-upload-preview::after {
        font-size: 0.75rem;
        bottom: 10px;
    }

    .sf-upload-remove {
        width: 44px;
        height: 44px;
        font-size: 22px;
    }
}

/* --- KIELIVERSIOLOMAKE --- */

.sf-form-language .sf-form-section {
    margin-bottom: 1.5rem;
}

.sf-form-language-meta .sf-form-meta-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 0.75rem 1.5rem;
}

.sf-meta-value {
    padding: 0.4rem 0.6rem;
    border-radius: 6px;
    background-color: #f9fafb;
    font-size: 0.9rem;
    color: #111827;
}

.sf-form-language-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    gap: 1.5rem;
}

.sf-lang-column h3 {
    margin-bottom: 0.75rem;
}

.sf-field textarea {
    width: 100%;
}

@media (max-width: 768px) {
    .sf-form-language-grid {
        grid-template-columns: minmax(0, 1fr);
    }
}

.sf-form-container.sf-form-language {
    max-width: 1100px;
    margin: 2rem auto;
    padding: 1.5rem 1.75rem;
}

.sf-translation-banner {
    border-radius: 12px;
    border: 1px solid #d1d5db;
    background: #f9fafb;
    padding: 1rem 1.25rem;
    margin-bottom: 1.5rem;
}

.sf-translation-banner-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.sf-translation-banner-meta {
    font-size: 0.85rem;
    color: #4b5563;
    margin-bottom: 0.35rem;
}

.sf-translation-banner-info {
    font-size: 0.85rem;
    color: #6b7280;
}

.sf-form-language-meta {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.25rem 1.5rem;
    box-shadow: 0 10px 25px rgba(15, 23, 42, 0.06);
    margin-bottom: 1.75rem;
}

.sf-form-language-meta h2 {
    margin-top: 0;
    margin-bottom: 0.75rem;
}

.sf-form-language-meta label {
    display: block;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #6b7280;
    margin-bottom: 0.1rem;
}

.sf-form-language-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    gap: 1.5rem;
    margin-bottom: 1.75rem;
}

.sf-lang-column {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.25rem 1.5rem;
    box-shadow: 0 10px 25px rgba(15, 23, 42, 0.06);
}

.sf-lang-column h3 {
    margin-top: 0;
    margin-bottom: 0.75rem;
}

.sf-lang-column .sf-field {
    margin-bottom: 1rem;
}

.sf-lang-column .sf-field label {
    display: block;
    font-size: 0.85rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.sf-lang-column .sf-field textarea,
.sf-lang-column .sf-field input[type="text"] {
    width: 100%;
}

.sf-lang-base .sf-meta-value {
    background-color: #f3f4f6;
}

.sf-form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
    margin-top: 0.5rem;
}

@media (max-width: 768px) {
    .sf-form-container.sf-form-language {
        margin: 1rem auto 2rem;
        padding: 1rem;
    }

    .sf-form-language-grid {
        grid-template-columns: minmax(0, 1fr);
    }
}

/* --- KIELIVERSIOEDITORI --- */

.sf-form-language {
    max-width: 1200px;
    margin: 2rem auto;
}

.sf-lang-header {
    background: #ffffff;
    padding: 1.25rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.07);
    margin-bottom: 1.5rem;
}

.sf-lang-header h2 {
    margin: 0 0 0.5rem;
}

.sf-lang-meta {
    font-size: 0.9rem;
    color: #4b5563;
    margin-bottom: 0.5rem;
}

.sf-lang-info {
    font-size: 0.85rem;
    color: #6b7280;
}

.sf-lang-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
}

.sf-lang-box {
    background: #ffffff;
    padding: 1.25rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.06);
}

.sf-lang-box h3 {
    margin: 0 0 1rem;
}

.sf-field label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.sf-field input[type=text],
.sf-field textarea {
    width: 100%;
    border: 1px solid #d1d5db;
    padding: 0.55rem 0.75rem;
    border-radius: 8px;
    resize: vertical;
}

.sf-base-text {
    background: #f8fafc;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 0.75rem;
    min-height: 40px;
}

.sf-lang-actions {
    margin-top: 1.5rem;
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
}

/* --- IMAGE MANIPULATION --- */

.sf-preview-image-frame,
.sf-preview-thumb-frame {
    position: relative;
    overflow: hidden;
    cursor: grab;
    touch-action: none;
    background-color: #f0f0f0;
    border: 1px solid #ddd;
}

.sf-preview-thumb-frame:last-child {
    margin-right: 0;
}

.sf-preview-image-frame:active,
.sf-preview-thumb-frame:active {
    cursor: grabbing;
}

.sf-preview-image {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(1);
    transform-origin: center center;
    max-width: none;
    max-height: none;
    width: auto;
    height: auto;
    min-width: 100%;
    min-height: 100%;
    user-select: none;
    pointer-events: none;
}

.sf-preview-img-element {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(1);
    transform-origin: center center;
    min-width: 100%;
    min-height: 100%;
    max-width: none;
    user-select: none;
    pointer-events: none;
    object-fit: cover;
}

/* GRID-BITMAP on lopullinen kollaasi → ei "cover+center", vaan täysi istuvuus frameen */
.sf-grid-bitmap-frame .sf-preview-img-element {
    top: 0;
    left: 0;
    transform: none;
    width: 100%;
    height: 100%;
    min-width: 0;
    min-height: 0;
    object-fit: contain;
}

.sf-edit-icon {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 24px;
    height: 24px;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    z-index: 10;
    opacity: 0.7;
}

.sf-edit-icon::after {
    content: '✋';
    color: #fff;
    font-size: 14px;
}

.sf-preview-image-frame:hover .sf-edit-icon,
.sf-preview-thumb-frame:hover .sf-edit-icon {
    opacity: 1;
    background: rgba(0, 123, 255, 0.8);
}

.sf-btn.hidden {
    display: none !important;
}

.sf-preview-wrapper,
.sf-preview-card,
.sf-preview-inner {
    overflow: visible;
}

.sf-preview-actions {
    clear: both !important;
    display: flex !important;
    gap: 16px;
    margin-top: 18px;
    justify-content: flex-end;
    max-width: 768px;
    margin-left: auto;
    margin-right: auto;
    box-sizing: border-box;
    position: relative;
    z-index: 20;
}

.sf-preview-actions .sf-btn {
    width: auto;
    padding: 12px 24px;
}

.sf-drag-handle {
    position: absolute;
    right: 8px;
    bottom: 8px;
    width: 36px;
    height: 36px;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 18px;
    cursor: grab;
    z-index: 30;
    touch-action: none;
    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.18);
}

.sf-drag-handle:active {
    cursor: grabbing;
}

.hide-for-capture {
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
}

/* --- KIELIVALINTA --- */

.sf-lang-selection {
    margin-bottom: 2rem;
}

.sf-lang-options {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 12px 0;
}

.sf-lang-box {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: #fff;
}

.sf-lang-box:hover {
    border-color: #FEE000;
    background: #fffef5;
}

.sf-lang-box.selected,
.sf-lang-box:has(input:checked) {
    border-color: #0f172a;
    background: #f8fafc;
}

.sf-lang-box.dim {
    opacity: 0.35;
    transform: none;
    pointer-events: none;
}

.sf-lang-box input[type="radio"] {
    display: none;
}

.sf-lang-box-content {
    display: flex;
    align-items: center;
    gap: 8px;
}

.sf-lang-flag {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    object-fit: contain;
}

.sf-lang-label {
    font-size: 14px;
    font-weight: 500;
    color: #1f2937;
}

.sf-divider {
    border: none;
    border-top: 1px solid #e5e7eb;
    margin: 1.5rem 0;
}

/* Napit alhaalla */
.sf-step-actions-bottom {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: none;
}

.sf-step-actions-bottom:has(:only-child) {
    justify-content: flex-end;
}

/* --- LOADING OVERLAY --- */
#sf-loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

#sf-loading-overlay.visible {
    opacity: 1;
    visibility: visible;
}

.sf-loading-content {
    background: #fff;
    padding: 40px 60px;
    border-radius: 16px;
    text-align: center;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
}

.sf-loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e5e7eb;
    border-top-color: #3b82f6;
    border-radius: 50%;
    margin: 0 auto 20px auto;
    animation: sf-spin 1s linear infinite;
}

@keyframes sf-spin {
    to {
        transform: rotate(360deg);
    }
}

.sf-loading-text {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 8px;
}

.sf-loading-subtext {
    font-size: 0.875rem;
    color: #6b7280;
}

.sf-btn.sf-btn-loading {
    opacity: 0.7;
    cursor: not-allowed;
}


/* ===== MOBIILI TYYLIT ===== */

.sf-type-box,
.sf-lang-box,
.sf-btn,
.footer-btn {
    touch-action: manipulation;
}

@media (max-width: 768px) {

    /* Otsikot */
    .sf-step-content h2 {
        font-size: 1.25rem;
        margin-top: 28px;
        /* More space from progress bar */
        margin-bottom: 16px;
        text-align: left;
        color: #0f172a;
    }

    .sf-step-content h3 {
        font-size: 1rem;
        margin-bottom: 12px;
        text-align: left;
        color: #374151;
    }

    .sf-help-text {
        font-size: 0.8rem;
        text-align: left;
        margin: 8px 0;
        color: #6b7280;
    }

    .sf-divider {
        margin: 16px 0;
    }

    /* Kielivalinta */
    .sf-lang-selection {
        margin-bottom: 16px;
    }

    .sf-lang-selection .sf-label {
        text-align: center;
        margin-bottom: 10px;
        font-size: 0.9rem;
    }

    .sf-lang-options {
        display: flex;
        justify-content: center;
        gap: 6px;
        flex-wrap: wrap;
        padding: 4px 0;
    }

    .sf-lang-box {
        flex: 0 0 auto;
        min-width: 60px;
        max-width: 80px;
        padding: 8px 10px;
        border-radius: 12px;
        border: 2px solid #e5e7eb;
        background: #fff;
    }

    .sf-lang-box.selected,
    .sf-lang-box:has(input:checked) {
        border-color: #0f172a;
        background: #f1f5f9;
    }

    .sf-lang-box-content {
        flex-direction: column;
        gap: 4px;
        align-items: center;
    }

    .sf-lang-flag {
        width: 24px;
        height: 24px;
    }

    .sf-lang-label {
        font-size: 0.65rem;
        color: #374151;
    }

    /* Tyyppivalinta - poistettu, käytetään ylempänä määriteltyä */
    /* Mobiilissa käytetään samaa horizontal layoutia kuin desktopissa */

    /* Progress bar: transparent background allows form's colored border to show through.
       No type-specific backgrounds - the form's red/yellow/green top border is visible beneath. */

    /* Kiinteä footer napeille - poistettu, käytetään ylempänä määriteltyä */

    .sf-btn {
        padding: 16px 24px;
        font-size: 1rem;
        min-height: 52px;
        border-radius: 14px;
        flex: 1;
        font-weight: 600;
    }

    .sf-btn-primary {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .sf-btn-secondary {
        background: #f1f5f9;
        border: 1px solid #e5e7eb;
    }

    /* Kentät */
    .sf-field-row {
        flex-direction: column;
        gap: 14px;
        width: 100%;
        max-width: 100%;
        overflow: hidden;
    }

    .sf-field {
        flex: 1 1 100%;
        min-width: 0;
        max-width: 100%;
        overflow: hidden;
    }

    input[type="datetime-local"],
    input[type="date"],
    input[type="time"] {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
    }

    .sf-step2-section {
        width: 100%;
        max-width: 100%;
        overflow: hidden;
    }

    .sf-label {
        font-size: 0.9rem;
        margin-bottom: 6px;
        font-weight: 600;
    }

    .sf-input,
    .sf-select,
    .sf-textarea {
        padding: 16px;
        font-size: 16px !important;
        border-radius: 12px;
        border: 1px solid #d1d5db;
        background: #fff;
        min-height: 56px;
        height: auto;
    }

    input[type="datetime-local"],
    input[type="date"],
    input[type="time"] {
        min-height: 56px !important;
        height: 56px !important;
        padding: 16px 44px 16px 16px !important;
    }

    .sf-select {
        min-height: 56px;
        padding: 16px 44px 16px 16px;
        width: 100%;
        display: block;
        font-size: 16px;
        line-height: 1.4;
        background-image: url('../img/icons/chevron-down.svg');
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 20px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
    }

    .sf-select option {
        padding: 12px 16px;
        font-size: 16px;
        line-height: 1.5;
        min-height: 44px;
    }

    .sf-select:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        outline: none;
    }

    .sf-select option[value=""] {
        color: #9ca3af;
    }

    .sf-select:not(:invalid) {
        color: #111827;
    }

    .sf-input:focus,
    .sf-select:focus,
    .sf-textarea:focus {
        border-color: #0f172a;
        box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
    }

    .sf-textarea {
        min-height: 120px;
    }

    /* Kalenterikuvake mobiilissa */
    .sf-field:has(input[type="datetime-local"])::after,
    .sf-field:has(input[type="date"])::after,
    .sf-field:has(input[type="time"])::after {
        top: auto;
        bottom: 19px;
        right: 14px;
        width: 18px;
        height: 18px;
        margin-top: 0;
        transform: none;
    }

    /* Kuvaupload */
    .sf-upload-row {
        flex-direction: column;
        gap: 14px;
    }

    .sf-upload-slot {
        padding: 14px;
        border-radius: 14px;
        background: #fff;
    }

    .sf-upload-preview {
        height: 120px;
        border-radius: 12px;
    }

    .sf-preview-wrapper {
        margin: 0 -16px 20px -16px;
        max-width: calc(100% + 32px);
        overflow: visible;
        /* Changed from hidden to prevent clipping */
        display: flex;
        justify-content: center;
        /* Center the card */
    }

    .sf-preview-card {
        border-radius: 0;
    }

    .sf-preview-sliders {
        margin: 0 0 20px 0;
        border-radius: 12px;
        padding: 14px;
    }

    .sf-preview-slider-row input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        height: 44px;
        background: transparent;
    }

    .sf-preview-slider-row input[type="range"]::-webkit-slider-runnable-track {
        height: 6px;
        background: #d1d5db;
        border-radius: 3px;
    }

    .sf-preview-slider-row input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: #3b82f6;
        margin-top: -11px;
        border: 2px solid #fff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .sf-preview-actions {
        flex-direction: column;
        gap: 12px;
        margin-bottom: 100px;
    }

    .sf-preview-actions .sf-btn {
        width: 100%;
    }

    .sf-grid-selector {
        display: none !important;
    }

    .sf-annotation-toolbar {
        padding: 14px;
        margin: 0 0 14px 0;
        border-radius: 12px;
    }

    .sf-annotation-btn {
        width: 44px;
        height: 44px;
    }

    /* Problem 4: Grid card overflow (step 5) */
    .sf-grid-card {
        max-width: 100%;
        overflow: hidden;
    }

    .sf-grid-card-label {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
    }

    .sf-step-content[data-step="5"] {
        overflow-x: hidden;
    }

    /* Problem 5: Ensure step actions bottom is visible on step 5 */
    .sf-step-content[data-step="5"] .sf-step-actions-bottom {
        position: static;
    }

    /* Problem 6: Reduce spacing between progress bar and preview content (step 6) */
    .sf-step-content[data-step="6"] {
        margin-top: 0;
        padding-top: 0;
    }

    .sf-step-content[data-step="6"]>h2:first-child {
        margin-top: 16px;
    }

    /* Reduce gap between progress bar and preview */
    .sf-preview-section {
        margin-top: 0;
        padding-top: 0;
    }



    /* Ensure form fields below preview are visible */
    .sf-supervisor-approval-section {
        position: relative;
        z-index: 1;
        background: #fff;
    }

    /* Problem 7: Supervisor/Approver chip overflow */
    .sf-supervisor-chip,
    .sf-approver-chip {
        max-width: calc(100vw - 60px);
        /* Account for container padding (30px each side) */
        overflow: hidden;
    }

    .sf-supervisor-chip .sf-chip-content,
    .sf-approver-chip .sf-chip-content {
        max-width: 100%;
        overflow: hidden;
    }

    .sf-supervisor-chip .sf-chip-info,
    .sf-approver-chip .sf-chip-info {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 100%;
    }

    .sf-supervisor-search-box {
        max-width: 100%;
        overflow: hidden;
    }

    .sf-supervisor-results {
        max-width: 100%;
    }
}

/* ===== PIENI NÄYTTÖ (< 400px) ===== */
@media (max-width: 400px) {

    .sf-type-icon {
        width: 56px;
        height: 56px;
    }

    .sf-type-title {
        font-size: 1.25rem;
    }

    .sf-type-box p {
        font-size: 0.9rem;
    }

    .sf-lang-box {
        padding: 8px 10px;
    }

    .sf-lang-flag {
        width: 28px;
        height: 28px;
    }

    .sf-lang-label {
        font-size: 0.6rem;
    }

    /* Napit alhaalla */
    .sf-step-actions-bottom {
        gap: 8px;
        border-top: none;
    }

    .sf-btn {
        padding: 14px 20px;
        min-height: 48px;
    }
}

/* ===== VALIDOINTIVIRHEET ===== */
.sf-validation-errors {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 14px 16px;
    margin-bottom: 20px;
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    border: 1px solid #fecaca;
    border-left: 4px solid #ef4444;
    border-radius: 12px;
    animation: sf-shake 0.4s ease;
}

@keyframes sf-shake {

    0%,
    100% {
        transform: translateX(0);
    }

    20%,
    60% {
        transform: translateX(-5px);
    }

    40%,
    80% {
        transform: translateX(5px);
    }
}

.sf-validation-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.sf-validation-content {
    flex: 1;
}

.sf-validation-content strong {
    display: block;
    color: #991b1b;
    margin-bottom: 6px;
    font-size: 0.95rem;
}

.sf-validation-content ul {
    margin: 0;
    padding-left: 18px;
    color: #b91c1c;
    font-size: 0.9rem;
}

.sf-validation-content li {
    margin-bottom: 4px;
}

.sf-validation-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #991b1b;
    cursor: pointer;
    padding: 0;
    line-height: 1;
    opacity: 0.7;
}

.sf-validation-close:hover {
    opacity: 1;
}

/* ===== MERKKIMÄÄRÄLASKURI ===== */
.sf-char-counter {
    text-align: right;
    font-size: 0.8rem;
    color: #6b7280;
    margin-top: 4px;
    font-weight: 500;
    transition: color 0.2s ease;
}

.sf-char-counter.sf-counter-warning {
    color: #d97706;
    font-weight: 600;
}

.sf-char-counter.sf-counter-error {
    color: #dc2626;
    font-weight: 700;
}

/* Kenttä punaiseksi kun yli rajan */
.sf-textarea:invalid,
.sf-input:invalid {
    border-color: #fca5a5;
    background: #fef2f2;
}

/* Mobiili validointivirheet */
@media (max-width: 768px) {
    .sf-validation-errors {
        padding: 12px 14px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }

    .sf-validation-icon {
        font-size: 1.25rem;
    }

    .sf-validation-content strong {
        font-size: 0.9rem;
    }

    .sf-validation-content ul {
        font-size: 0.85rem;
    }

    .sf-char-counter {
        font-size: 0.75rem;
    }
}

/* ===== KUVA-UPLOAD UUSI LAYOUT ===== */

.sf-image-upload-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 16px;
}

.sf-image-upload-card {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.sf-image-upload-label {
    font-weight: 600;
    font-size: 0.9rem;
    color: #374151;
}

.sf-image-upload-area {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.sf-image-preview {
    position: relative;
    width: 100%;
    height: 160px;
    background: #f3f4f6;
    border: 2px dashed #d1d5db;
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

.sf-image-preview img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.sf-image-preview img[src*="camera-placeholder"] {
    width: 80px;
    height: 80px;
    opacity: 0.4;
}

.sf-image-preview.has-image {
    border-style: solid;
    border-color: #d1d5db;
}

.sf-image-preview.has-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.sf-image-remove-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.7);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    z-index: 10;
    transition: background 0.2s ease;
}

.sf-image-remove-btn:hover {
    background: #dc2626;
}

.sf-image-remove-btn.hidden {
    display: none;
}

/* Loading indicator for image upload */
.sf-image-upload-card.sf-image-loading .sf-image-preview::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 20;
}

.sf-image-upload-card.sf-image-loading .sf-image-preview::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 3px solid rgba(0, 0, 0, 0.1);
    border-top-color: #fee000;
    border-radius: 50%;
    animation: sf-spinner-rotate 0.8s linear infinite;
    z-index: 21;
}

@keyframes sf-spinner-rotate {
    from {
        transform: translate(-50%, -50%) rotate(0deg);
    }

    to {
        transform: translate(-50%, -50%) rotate(360deg);
    }
}

.sf-image-upload-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* Camera button styling */
.sf-image-camera-btn {
    background: #3b82f6 !important;
    color: #fff !important;
    border-color: #3b82f6 !important;
}

.sf-image-camera-btn:hover {
    background: #2563eb !important;
    border-color: #2563eb !important;
}

.sf-image-camera-btn .sf-btn-icon {
    filter: brightness(0) invert(1);
    opacity: 1;
}

/* ===== CAMERA BUTTON - Hide on desktop ===== */
/* Camera capture only works on mobile devices, so hide on desktop */
@media (min-width: 1025px) {
    .sf-image-camera-btn {
        display: none !important;
    }
}

.sf-image-upload-btn,
.sf-image-library-btn,
.sf-image-edit-inline-btn {
    flex: 1 1 160px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;

    padding: 10px 14px;
    min-height: 44px;

    border: 1px solid #d1d5db;
    border-radius: 12px;
    background: #ffffff;

    cursor: pointer;

    font-size: 14px;
    line-height: 1.2;
    font-weight: 600;
    color: #111827;

    transition: background 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease, transform 0.05s ease;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

.sf-image-upload-btn:hover,
.sf-image-library-btn:hover,
.sf-image-edit-inline-btn:hover {
    background: #f9fafb;
    border-color: #9ca3af;
    box-shadow: 0 1px 0 rgba(17, 24, 39, 0.04);
}

.sf-image-upload-btn:active,
.sf-image-library-btn:active,
.sf-image-edit-inline-btn:active {
    transform: translateY(1px);
}

.sf-image-edit-inline-btn:disabled {
    opacity: 0.55;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.sf-image-library-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
    background: #f3f4f6;
    color: #9ca3af;
}

.sf-image-upload-btn input[type="file"] {
    display: none;
}

.sf-btn-icon {
    width: 18px;
    height: 18px;
    opacity: 0.7;
    /* Oletuksena tumma ikoni */
    filter: none;
}

/* Tumman taustan napit - valkoinen ikoni */
.sf-image-upload-btn .sf-btn-icon {
    filter: brightness(0) invert(1);
}

/* CTA edit -nappi (musta tausta) - valkoinen ikoni */
.sf-image-upload-btn.sf-cta-edit .sf-btn-icon {
    filter: brightness(0) invert(1);
}

/* Vaalean taustan napit - tumma ikoni, hieman läpinäkyvä */
.sf-image-library-btn .sf-btn-icon {
    filter: brightness(0);
    opacity: 0.55;
}

.sf-image-edit-inline-btn .sf-btn-icon {
    filter: brightness(0);
    opacity: 0.55;
}

.sf-image-input {
    display: none;
}

/* Mobiili kuva-upload */
@media (max-width: 768px) {
    .sf-image-upload-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }

    .sf-image-preview {
        height: 200px;
    }

    .sf-image-upload-actions {
        flex-direction: row;
    }
}

@media (max-width: 480px) {
    .sf-image-preview {
        height: 160px;
    }
}

/* Merkkimäärälaskuri */
.sf-char-count {
    font-size: 0.75rem;
    color: #64748b;
    text-align: right;
    margin-top: 4px;
    margin-bottom: 0;
}

/* ============================================
   ALKUPERÄINEN TIEDOTE - KOMPAKTI NÄKYMÄ
   ============================================ */

.sf-original-flash-compact {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 16px;
    margin-bottom: 1.25rem;
    background: #fff;
    border-left-width: 6px;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
}

.sf-original-flash-compact.hidden {
    display: none ! important;

}

/* Tyypin mukaan vaihtuva väri */
.sf-original-flash-compact.type-red {
    border-color: #dc2626;
    border-left: solid 6px;
}

.sf-original-flash-compact.type-yellow {
    border-color: #eab308;
    border-left: solid 6px;
}

.sf-original-icon {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
    object-fit: contain;
}

.sf-original-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1;
    min-width: 0;
}

.sf-original-title {
    font-size: 1rem;
    font-weight: 700;
    color: #0f172a;
    line-height: 1.3;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.sf-original-meta {
    display: flex;
    gap: 12px;
    font-size: 0.85rem;
    color: #6b7280;
}

.sf-original-meta span:first-child {
    position: relative;
    padding-left: 20px;
}

.sf-original-meta span:first-child::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    width: 14px;
    height: 14px;
    transform: translateY(-50%);
    background-color: currentColor;
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 21s-6-5.686-6-10a6 6 0 1112 0c0 4.314-6 10-6 10z' fill='none' stroke='black' stroke-width='2'/%3E%3Ccircle cx='12' cy='11' r='2.5' fill='none' stroke='black' stroke-width='2'/%3E%3C/svg%3E");
    mask-repeat: no-repeat;
    mask-size: contain;
    mask-position: center;
}

.sf-original-meta span:last-child {
    position: relative;
    padding-left: 20px;
}

.sf-original-meta span:last-child::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    width: 14px;
    height: 14px;
    transform: translateY(-50%);
    background-color: currentColor;
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2' fill='none' stroke='black' stroke-width='2'/%3E%3Cline x1='16' y1='2' x2='16' y2='6' stroke='black' stroke-width='2'/%3E%3Cline x1='8' y1='2' x2='8' y2='6' stroke='black' stroke-width='2'/%3E%3Cline x1='3' y1='10' x2='21' y2='10' stroke='black' stroke-width='2'/%3E%3C/svg%3E");
    mask-repeat: no-repeat;
    mask-size: contain;
    mask-position: center;
}

/* Mobiili */
@media (max-width: 768px) {
    .sf-original-flash-compact {
        padding: 12px 14px;
        gap: 12px;
    }

    .sf-original-icon {
        width: 40px;
        height: 40px;
    }

    .sf-original-title {
        font-size: 0.95rem;
    }

    .sf-original-meta {
        flex-direction: column;
        gap: 2px;
        font-size: 0.8rem;
    }
}

/* ===== KAHDEN DIAN ILMOITUS ===== */

.sf-two-slides-notice {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
    border: 1px solid #10b981;
    border-left: 4px solid #10b981;
    border-radius: 8px;
    padding: 12px 16px;
    margin: 16px 0;
    animation: sfSlideIn 0.3s ease-out;
}

.sf-two-slides-notice .sf-notice-icon {
    font-size: 1.2rem;
    flex-shrink: 0;
}

.sf-two-slides-notice .sf-notice-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.sf-two-slides-notice .sf-notice-text strong {
    font-size: 0.9rem;
    color: #065f46;
}

.sf-two-slides-notice .sf-notice-text span {
    font-size: 0.8rem;
    color: #047857;
}

@keyframes sfSlideIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Step 6 (Preview): piilota muokkaustyökalut jos niitä on DOMissa */
.sf-step-content[data-step="6"] .sf-edit-anno-btn,
.sf-step-content[data-step="6"] #sf-edit-img-zoom-in,
.sf-step-content[data-step="6"] #sf-edit-img-zoom-out,
.sf-step-content[data-step="6"] #sf-edit-img-move-left,
.sf-step-content[data-step="6"] #sf-edit-img-move-right,
.sf-step-content[data-step="6"] #sf-edit-img-move-up,
.sf-step-content[data-step="6"] #sf-edit-img-move-down,
.sf-step-content[data-step="6"] #sf-edit-img-reset,
.sf-step-content[data-step="6"] #sf-edit-anno-rotate,
.sf-step-content[data-step="6"] #sf-edit-anno-size-up,
.sf-step-content[data-step="6"] #sf-edit-anno-size-down,
.sf-step-content[data-step="6"] #sf-edit-anno-delete,
.sf-step-content[data-step="6"] #sf-edit-img-add-label {
    display: none !important;
}

/* Image editor modal (single source of truth) */
.sf-edit-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.50);
    z-index: 100001;

    display: flex;
    justify-content: center;
    align-items: center;

    padding: calc(24px + env(safe-area-inset-top, 0px)) 16px calc(24px + env(safe-area-inset-bottom, 0px));
    box-sizing: border-box;

    /* Blur-efekti taustalle */
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

.sf-edit-modal-card {
    background: #fff;
    border-radius: 16px;
    max-width: 1200px;
    width: 100%;

    display: flex;
    flex-direction: column;

    /* footer pysyy aina näkyvissä */
    max-height: calc(100vh - 48px);
    overflow: hidden;

    position: relative;
    padding: 22px;
}

.sf-edit-modal-header {
    flex: 0 0 auto;
}

.sf-edit-modal-body {
    flex: 1 1 auto;
    overflow: auto;
    padding-top: 12px;
    padding-bottom: 12px;
}

.sf-edit-modal-footer {
    flex: 0 0 auto;
    border-top: 1px solid #e5e7eb;
    padding-top: 14px;
    background: #fff;
}

/* Close button */
.sf-edit-close {
    position: absolute;
    top: 14px;
    right: 14px;
    width: 42px;
    height: 42px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    background: #fff;
    font-size: 22px;
    line-height: 1;
    cursor: pointer;
}

/* --- TEXT MODAL (sfTextModal) --- */
/* Tekstimodaali - TÄYTYY olla korkeampi */
#sfTextModal,
.sf-modal#sfTextModal {
    z-index: 100010 !important;
}

/* Mobiilissa vielä korkeampi ja varmista ettei jää näppäimistön alle */
@media (max-width: 768px) {

    #sfTextModal,
    .sf-modal#sfTextModal {
        z-index: 100020 !important;
        top: env(safe-area-inset-top, 0px);
        align-items: flex-start;
        padding-top: calc(20px + env(safe-area-inset-top, 0px));
        /* Issue 4: Force new stacking context for proper layering on mobile */
        transform: translateZ(0);
    }
}

.sf-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, .60);
    z-index: 100002;
    /* Issue 4: Higher than edit modal (100001) */
    display: flex;
    align-items: center;
    justify-content: center;
    padding: calc(24px + env(safe-area-inset-top, 0px)) 16px calc(24px + env(safe-area-inset-bottom, 0px));
    box-sizing: border-box;
}

/* Issue 4: Ensure text modal is on top on mobile */
@media (max-width: 768px) {
    .sf-modal {
        z-index: 100003;
        /* Even higher on mobile to ensure it's above everything */
    }
}

.sf-modal.hidden {
    display: none;
}

.sf-modal-dialog {
    width: min(560px, 100%);
    background: #fff;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, .25);
    border: 1px solid #e5e7eb;
}

.sf-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 18px;
    border-bottom: 1px solid #eef2f7;
}

.sf-modal-body {
    padding: 16px 18px;
}

.sf-modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding: 16px 18px;
    border-top: 1px solid #eef2f7;
}

.sf-modal-close {
    width: 40px;
    height: 40px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    background: #fff;
    font-size: 22px;
    line-height: 1;
    cursor: pointer;
}

/* Workspace: canvas vasen, työkalut oikea */
.sf-edit-workspace {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 18px;
    align-items: start;
}

.sf-edit-canvas-col {
    min-width: 0;
}

.sf-edit-tools-col {
    position: sticky;
    top: 0;
}

.sf-edit-canvas {
    width: 100%;
    height: 100%;
    display: block;
}

/* Toolbar oikeaan palstaan siististi */
.sf-edit-toolbar {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.sf-edit-toolrow {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.sf-edit-toollabel {
    font-weight: 700;
    font-size: 0.9rem;
    margin-top: 6px;
}

/* Mobiili: palstat allekkain */
@media (max-width: 900px) {
    .sf-edit-workspace {
        grid-template-columns: 1fr;
    }

    .sf-edit-tools-col {
        position: static;
    }
}

.sf-grid-options {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
}

.sf-grid-card {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 12px;
    border: 1px solid #d8e3f0;
    border-radius: 10px;
    background: #f8fbff;
    cursor: pointer;
    min-width: 280px;
}

.sf-grid-card.active {
    border-color: #2f6fed;
    box-shadow: 0 0 0 2px rgba(47, 111, 237, 0.15);
}

.sf-grid-card-thumb {
    /* Matchaa paremmin 1790x1250 (~1.432) */
    width: 140px;
    height: 98px;

    border-radius: 8px;
    border: 1px solid #e2ebf7;
    background: #fff;

    /* ettei "leikkaa" */
    object-fit: contain;

    /* pieni sisämarginaali tekee thumbista siistimmän */
    padding: 4px;
    box-sizing: border-box;
}

.sf-grid-card-label {
    font-weight: 600;
}

/* Disabled-napit selkeämmin pois käytöstä */
.sf-edit-toolrow button:disabled {
    opacity: .45;
    cursor: not-allowed;
}

#sf-edit-img-zoom-in,
#sf-edit-img-zoom-out {
    background-color: #C9A227;
    /* kirkas kulta – erottuu harmaasta */
    color: #ffffff;
    transition: background-color 0.15s ease, box-shadow 0.15s ease;
}

#sf-edit-img-zoom-in:hover,
#sf-edit-img-zoom-out:hover {
    background-color: #E0B92D;
    /* hover: selvästi kirkkaampi */
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.15);
}

#sf-edit-anno-delete {
    background: #ffebee;
}

.sf-image-actions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
}

/* SKOUPPAA NÄMÄ VAIN KUVA-ACTIONEIHIN, ettei riko koko lomakkeen muita nappeja */
.sf-image-actions .sf-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;

    height: 40px;
    padding: 0 14px;

    font-size: 14px;
    font-weight: 500;
    line-height: 1;

    border-radius: 8px;
    border: 1px solid #d0d7e2;
    background: #f8fafc;
    color: #0f172a;

    cursor: pointer;
    transition: all 0.15s ease;
}

.sf-image-actions .sf-btn svg,
.sf-image-actions .sf-btn img {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
}

/* Primary: Lataa */
.sf-image-actions .sf-btn--primary {
    background: #0f172a;
    color: #ffffff;
    border-color: #0f172a;
}

.sf-image-actions .sf-btn--primary svg,
.sf-image-actions .sf-btn--primary img {
    filter: invert(1);
}

/* Disabled */
.sf-image-actions .sf-btn[disabled] {
    opacity: 0.45;
    cursor: not-allowed;
}

/* Tekstimodaali: textarea */
#sfTextModalInput.sf-input {
    min-height: 110px;
    resize: vertical;
    line-height: 1.35;
    padding: 12px 14px;
    white-space: pre-wrap;
}

.sf-tool-hint {
    font-size: 13px;
    color: #475569;
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    padding: 10px 12px;
    border-radius: 12px;
    margin-bottom: 10px;
}

.sf-tool-hint.hidden {
    display: none;
}

/* --- Image card: stateful UI --- */
.sf-image-preview {
    position: relative;
}

/* rasti näkyy vain kun on kuva (JS lisää .has-image preview:lle) */
.sf-image-preview:not(.has-image) .sf-image-remove-btn {
    display: none;
}

/* "Muokattu" badge */
.sf-image-edited-badge {
    position: absolute;
    left: 12px;
    top: 12px;
    z-index: 3;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 700;
    background: rgba(15, 23, 42, .86);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, .16);
    backdrop-filter: blur(6px);
}

.sf-image-edited-badge.hidden {
    display: none;
}

/* CTA: sama nappi näyttää Lataa tai Muokkaa */
.sf-image-upload-btn.sf-cta-edit {
    background: #0f172a;
    color: #fff;
    border-color: #0f172a;
}

.sf-image-upload-btn.sf-cta-edit .sf-btn-icon {
    filter: brightness(0) invert(1);
}

/* --- CONFIRM REMOVE MODAL (sfConfirmRemoveModal) --- */
#sfConfirmRemoveModal .sf-confirm-dialog {
    width: min(520px, 100%);
}

#sfConfirmRemoveModal .sf-confirm-text {
    margin: 0;
    font-size: 16px;
    line-height: 1.45;
    color: #111827;
}

.sf-edit-canvas {
    display: block;
    width: 100%;
    height: auto;
}

@media (max-width: 768px) {
    .sf-edit-canvas-wrap {
        max-width: 100%;
        border-radius: 8px;
    }
}

/* ===== ALKUPERÄISEN TIEDOTTEEN KOMPAKTI ESIKATSELU ===== */
.sf-original-flash-compact {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px 20px;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border: 1px solid #e2e8f0;
    border-left: 4px solid #fbbf24;
    border-radius: 12px;
    margin: 16px 0 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    transition: all 0.2s ease;
}

.sf-original-flash-compact:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.sf-original-flash-compact.type-red {
    border-left-color: #ef4444;
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
}

.sf-original-flash-compact.type-yellow {
    border-left-color: #f59e0b;
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
}

.sf-original-icon {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

.sf-original-info {
    flex: 1;
    min-width: 0;
}

.sf-original-title {
    display: block;
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 4px;
    line-height: 1.4;
}

.sf-original-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 8px 16px;
    font-size: 0.85rem;
    color: #64748b;
}

.sf-original-meta span {
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.sf-original-meta span:: before {
    content: '';
    display: inline-block;
    width: 16px;
    height: 16px;
    background-size: contain;
    background-repeat: no-repeat;
    opacity: 0.6;
}

#sf-original-site:: before {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2'%3E%3Cpath d='M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'/%3E%3Ccircle cx='12' cy='10' r='3'/%3E%3C/svg%3E");
}

#sf-original-date::before {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'/%3E%3Cline x1='16' y1='2' x2='16' y2='6'/%3E%3Cline x1='8' y1='2' x2='8' y2='6'/%3E%3Cline x1='3' y1='10' x2='21' y2='10'/%3E%3C/svg%3E");
}

/* Mobiili */
@media (max-width: 600px) {
    .sf-original-flash-compact {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
        padding: 14px 16px;
    }

    .sf-original-icon {
        width: 40px;
        height: 40px;
    }

    .sf-original-title {
        font-size: 0.95rem;
    }

    .sf-original-meta {
        font-size: 0.8rem;
    }
}

/* ==========================================================================
   Tablet Image Upload Grid
   ========================================================================== */

@media (min-width: 768px) and (max-width: 1024px) {
    .sf-image-upload-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    .sf-image-upload-card: first-child {
        grid-column: span 2;
    }

    .sf-image-upload-card:first-child .sf-image-preview {
        aspect-ratio: 16/9;
    }
}

/* ==========================================================================
   Better Touch Targets for Mobile
   ========================================================================== */

@media (max-width: 768px) {
    .sf-btn {
        min-height: 48px;
        padding: 12px 20px;
    }

    .sf-image-upload-btn,
    .sf-image-library-btn {
        min-height: 44px;
        padding: 12px 14px;
    }

    .sf-type-box {
        min-height: 80px;
    }

    .sf-lang-box {
        min-height: 60px;
    }
}

/* ==========================================================================
   iOS Safari Fixed Footer Fix
   ========================================================================== */

@supports (-webkit-touch-callout: none) {
    .sf-step-actions-bottom {
        padding-bottom: calc(16px + env(safe-area-inset-bottom, 20px));
    }

    body.sf-modal-open {
        position: fixed;
        width: 100%;
        overflow: hidden;
    }
}

/* ===== KUVAEDITORI:  MERKINTÄPAINIKKEET ===== */

.sf-edit-modal-card.sf-edit-compact {
    max-width: 1100px;
    padding: 0;
    border-radius: 16px;
    overflow: hidden;
}

/* Header */
.sf-edit-modal-header-compact {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 18px;
    background: #f8fafc;
    border-bottom: 1px solid #e5e7eb;
}

.sf-edit-header-left h2 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: #0f172a;
}

.sf-edit-close-compact {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
    background: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #64748b;
    transition: all 0.15s ease;
}

.sf-edit-close-compact:hover {
    background: #f1f5f9;
    color: #0f172a;
}

.sf-edit-header-actions {
    display: flex;
    gap: 6px;
    align-items: center;
}

/* Icon coloring for info button — matches the muted slate (#64748b) of the close button's default color */
#sf-edit-crop-info-btn img {
    width: 18px;
    height: 18px;
    display: block;
    filter: brightness(0) saturate(100%) invert(40%) sepia(10%) saturate(400%) hue-rotate(190deg);
}

#sf-edit-crop-info-btn:hover img {
    filter: brightness(0) saturate(100%) invert(10%);
}

/* Body */
.sf-edit-modal-body-compact {
    display: grid;
    grid-template-columns: 1fr 140px;
    gap: 0;
    background: #fff;
}

/* Canvas area */
.sf-edit-canvas-area {
    display: flex;
    flex-direction: column;
    background: #1e293b;
    padding: 12px;
}

.sf-edit-canvas-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 300px;
    max-height: 55vh;
    width: 100%;
    overflow: hidden;
    touch-action: none;
}

.sf-edit-canvas {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    aspect-ratio: 16 / 9;
    object-fit: contain;
    border-radius: 8px;
    touch-action: none;
    -webkit-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

#sf-edit-img-canvas {
    touch-action: none;
    -webkit-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

/* Ensure modal body allows touch scrolling but canvas prevents it */
.sf-edit-modal-body-compact {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* Canvas controls */
.sf-edit-canvas-controls {
    padding: 10px 0 0;
    display: flex;
    justify-content: center;
}

.sf-edit-control-group {
    display: flex;
    align-items: center;
    gap: 4px;
    background: rgba(255, 255, 255, 0.1);
    padding: 4px;
    border-radius: 10px;
}

.sf-edit-ctrl-btn {
    width: 34px;
    height: 34px;
    border: none;
    background: rgba(255, 255, 255, 0.15);
    color: #fff;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all 0.15s ease;
}

.sf-edit-ctrl-btn:hover {
    background: rgba(255, 255, 255, 0.25);
}

.sf-edit-ctrl-btn.sf-edit-ctrl-text {
    width: auto;
    padding: 0 12px;
    font-size: 12px;
    font-weight: 500;
}

.sf-edit-ctrl-divider {
    width: 1px;
    height: 20px;
    background: rgba(255, 255, 255, 0.2);
    margin: 0 4px;
}

/* Sidebar */
.sf-edit-sidebar {
    background: #f8fafc;
    border-left: 1px solid #e5e7eb;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.sf-edit-sidebar-section {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.sf-edit-sidebar-title {
    margin: 0;
    font-size: 0.85rem;
    font-weight: 600;
    color: #0f172a;
}

.sf-edit-sidebar-hint {
    margin: 0;
    font-size: 0.7rem;
    color: #64748b;
    line-height: 1.4;
}

/* Anno grid - 3 saraketta, kompaktimpi */
.sf-edit-anno-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
}

.sf-edit-anno-btn {
    width: 100%;
    aspect-ratio: 1;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    position: relative;
}

/* Neutraalit taustat - hyvä kontrasti kaikille ikoneille ja värisokeille */
.sf-edit-anno-btn {
    background: #ffffff;
    border: 2px solid #e2e8f0;
}

.sf-edit-anno-btn:hover {
    background: #f8fafc;
    border-color: #94a3b8;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
}

.sf-edit-anno-btn.active {
    background: #f0f9ff;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
    transform: scale(1.05);
}

/* Ikoneille hieman varjoa erottuvuuden parantamiseksi */
.sf-edit-anno-btn .sf-anno-icon {
    width: 28px;
    height: 28px;
    object-fit: contain;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.15));
}

/* Sidebar hieman leveämpi jotta 3 saraketta mahtuu */
.sf-edit-modal-body-compact {
    display: grid;
    grid-template-columns: 1fr 180px;
    gap: 0;
    background: #fff;
}

.sf-edit-sidebar {
    background: #f8fafc;
    border-left: 1px solid #e5e7eb;
    padding: 16px 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* Valintakontrollit siistimmiksi */
.sf-edit-selected-row {
    display: flex;
    gap: 6px;
    justify-content: center;
}

.sf-edit-sel-btn {
    width: 36px;
    height: 36px;
    flex: none;
    border: 1px solid #e5e7eb;
    background: #fff;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #64748b;
    font-size: 14px;
    transition: all 0.15s ease;
}

.sf-edit-sel-btn:hover:not(:disabled) {
    background: #f1f5f9;
    border-color: #cbd5e1;
    color: #334155;
}

.sf-edit-sel-btn:disabled {
    opacity: 0.35;
    cursor: not-allowed;
}

.sf-edit-sel-btn.sf-edit-sel-danger:hover:not(:disabled) {
    background: #fef2f2;
    border-color: #fecaca;
    color: #dc2626;
}

/* Teksti-nappi */
.sf-edit-text-btn {
    width: 100%;
    padding: 12px;
    border: 2px dashed #cbd5e1;
    background: #fff;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    color: #64748b;
    transition: all 0.2s ease;
}

.sf-edit-text-btn:hover:not(:disabled) {
    border-color: #3b82f6;
    background: #eff6ff;
    color: #3b82f6;
}

.sf-edit-sel-btn.sf-edit-sel-danger:hover:not(:disabled) {
    background: #fef2f2;
    border-color: #fecaca;
    color: #dc2626;
}

/* Text button */
.sf-edit-text-btn {
    width: 100%;
    padding: 10px;
    border: 1px dashed #d1d5db;
    background: #fff;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 0.8rem;
    font-weight: 500;
    color: #64748b;
    transition: all 0.15s ease;
}

.sf-edit-text-btn:hover:not(:disabled) {
    border-color: #3b82f6;
    background: #eff6ff;
    color: #3b82f6;
}

.sf-edit-text-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* Footer */
.sf-edit-modal-footer-compact {
    padding: 12px 18px;
    background: #f8fafc;
    border-top: 1px solid #e5e7eb;
    display: flex;
    justify-content: flex-end;
}

@media (max-width: 800px) {
    .sf-edit-modal-body-compact {
        grid-template-columns: 1fr;
    }

    .sf-edit-sidebar {
        border-left: none;
        border-top: 1px solid #e5e7eb;
        padding: 12px;
    }

    /* Problem 2: Image editor toolbar - make toolbar buttons smaller and wrap */
    .sf-edit-toolrow {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: center;
    }

    .sf-edit-toolrow button {
        padding: 8px 12px;
        font-size: 0.8rem;
        min-width: auto;
    }

    .sf-edit-canvas-area {
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden;
    }

    .sf-edit-modal-card {
        max-width: 100vw;
        overflow-x: hidden;
    }

    /* Mobiilissa 6 ikonia yhdelle riville */
    .sf-edit-anno-grid {
        display: flex;
        flex-wrap: nowrap;
        gap: 8px;
        justify-content: center;
    }

    /* Mobiilissa pienemmät painikkeet */
    .sf-edit-anno-btn {
        width: 44px;
        height: 44px;
        padding: 8px;
        flex-shrink: 0;
    }

    .sf-edit-anno-btn .sf-anno-icon {
        width: 24px;
        height: 24px;
    }

    .sf-edit-canvas-wrap {
        min-height: 250px;
        max-height: 45vh;
    }

    /* Valintakohtaiset kontrollit yhdelle riville */
    .sf-edit-selected-controls {
        padding-top: 10px;
    }

    .sf-edit-selected-row {
        justify-content: center;
    }

    .sf-edit-sel-btn {
        flex: 0 0 40px;
        height: 40px;
    }

    /* Teksti-nappi pienempi */
    .sf-edit-text-btn {
        padding: 8px 12px;
        font-size: 0.75rem;
    }

    /* Sidebar title ja hint pienempi */
    .sf-edit-sidebar-title {
        font-size: 0.8rem;
        text-align: center;
    }

    .sf-edit-sidebar-hint {
        text-align: center;
        font-size: 0.65rem;
    }
}

@media (max-width: 500px) {
    .sf-edit-anno-btn {
        width: 40px;
        height: 40px;
        padding: 6px;
    }

    .sf-edit-anno-btn .sf-anno-icon {
        width: 22px;
        height: 22px;
    }

    .sf-edit-sel-btn {
        flex: 0 0 36px;
        height: 36px;
    }
}

/* ===== CLICKABLE PROGRESS STEPS ===== */
.sf-progress-steps {
    display: flex;
    justify-content: space-between;
    margin-top: 16px;
    gap: 4px;
    position: relative;
}

/* Progress line connecting steps */
.sf-progress-steps::before {
    content: '';
    position: absolute;
    top: 16px;
    left: 5%;
    right: 5%;
    height: 3px;
    background: linear-gradient(90deg, #e5e7eb 0%, #d1d5db 100%);
    border-radius: 999px;
    z-index: 0;
}

.sf-progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    background: transparent;
    border: none;
    padding: 4px 8px;
    cursor: pointer;
    border-radius: 12px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    flex: 1;
    min-width: 0;
    position: relative;
    z-index: 1;
}

.sf-progress-step:hover:not(:disabled) {
    background: linear-gradient(135deg, rgba(254, 224, 0, 0.1) 0%, rgba(15, 23, 42, 0.05) 100%);
    transform: translateY(-2px);
}

.sf-progress-step:disabled {
    cursor: not-allowed;
    opacity: 0.5;
}

.sf-step-number {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
    border: 3px solid #d1d5db;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.95rem;
    color: #6b7280;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    position: relative;
}

.sf-step-number::before {
    content: attr(data-step-num);
}

.sf-step-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #6b7280;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    transition: all 0.3s ease;
}

/* Completed steps (checkmark with green gradient) */
.sf-progress-step.completed .sf-step-number {
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    border-color: #16a34a;
    color: #fff;
    box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
    animation: sf-progress-nav-pulse 0.5s ease-out;
}

@keyframes sf-progress-nav-pulse {
    0% {
        transform: scale(1);
    }

    50% {
        transform: scale(1.15);
    }

    100% {
        transform: scale(1);
    }
}

.sf-progress-step.completed .sf-step-number::before {
    content: '✓';
    /* Unicode U+2713 - CHECK MARK */
    font-size: 1rem;
    font-weight: bold;
}

.sf-progress-step.completed .sf-step-label {
    color: #16a34a;
    font-weight: 700;
}

.sf-progress-step.completed:hover:not(:disabled) .sf-step-number {
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 6px 16px rgba(34, 197, 94, 0.5);
}

/* Active step (black with yellow accent) */
.sf-progress-step.active .sf-step-number {
    background: linear-gradient(135deg, var(--sf-black) 0%, #1e293b 100%);
    border-color: var(--sf-black);
    color: #fff;
    transform: scale(1.15);
    box-shadow: 0 6px 16px rgba(15, 23, 42, 0.5), 0 0 0 3px rgba(254, 224, 0, 0.3);
    animation: sf-progress-nav-active-glow 2s ease-in-out infinite;
}

@keyframes sf-progress-nav-active-glow {

    0%,
    100% {
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.5), 0 0 0 3px rgba(254, 224, 0, 0.3);
    }

    50% {
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.5), 0 0 0 5px rgba(254, 224, 0, 0.5);
    }
}

.sf-progress-step.active .sf-step-label {
    color: var(--sf-black);
    font-weight: 800;
    text-shadow: 0 1px 2px rgba(254, 224, 0, 0.2);
}

.sf-progress-step.active:hover .sf-step-number {
    transform: scale(1.15);
}

/* Accessible (can navigate to) */
.sf-progress-step.accessible:not(.active):not(.completed) .sf-step-number {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
    border-color: #3b82f6;
    color: #3b82f6;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
}

.sf-progress-step.accessible:not(.active):not(.completed):hover .sf-step-number {
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.sf-progress-step.accessible:not(.active):not(.completed) .sf-step-label {
    color: #3b82f6;
}

/* Locked (cannot navigate yet) */
.sf-progress-step.locked {
    cursor: not-allowed;
}

.sf-progress-step.locked .sf-step-number {
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    border-color: #e5e7eb;
    color: #9ca3af;
    box-shadow: none;
}

.sf-progress-step.locked .sf-step-label {
    color: #9ca3af;
}

.sf-progress-step.locked:hover {
    background: transparent;
    transform: none;
}

/* Focus state with yellow outline */
.sf-progress-step:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px rgba(254, 224, 0, 0.6);
    background: linear-gradient(135deg, rgba(254, 224, 0, 0.1) 0%, rgba(15, 23, 42, 0.05) 100%);
}

/* ===== MOBILE PROGRESS STEPS ===== */
@media (max-width: 768px) {
    .sf-progress-steps {
        gap: 2px;
        margin-top: 12px;
    }

    .sf-progress-steps::before {
        top: 14px;
        left: 8%;
        right: 8%;
        height: 2px;
    }

    .sf-progress-step {
        padding: 4px 2px;
    }

    .sf-step-number {
        width: 30px;
        height: 30px;
        font-size: 0.85rem;
        border-width: 2px;
        /* Issue 2: Ensure perfect circles on mobile */
        border-radius: 50%;
        box-sizing: border-box;
    }

    .sf-step-label {
        font-size: 0.6rem;
        display: none;
        /* Hide labels on mobile */
    }

    .sf-progress-step.active .sf-step-number {
        transform: scale(1.1);
    }

    .sf-progress-step:hover:not(:disabled) {
        transform: translateY(-1px);
    }
}

@media (max-width: 480px) {
    .sf-progress-steps::before {
        left: 10%;
        right: 10%;
    }

    .sf-step-number {
        width: 26px;
        height: 26px;
        font-size: 0.75rem;
    }

    .sf-progress-step.active .sf-step-number {
        transform: scale(1.05);
    }

    .sf-progress-step.completed .sf-step-number::before {
        font-size: 0.85rem;
        /* Smaller check mark on mobile */
    }
}

/* =============================================================================
   FORM HEADER (CLOSE BUTTON + PROGRESS BAR)
   ============================================================================= */

/* Container for close icon + progress bar */
.sf-form-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 16px;
    /* Distance from header */
    padding: 0 16px;
}

/* Close icon */
.sf-form-close-icon {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.2s, transform 0.2s;
    text-decoration: none;
}

.sf-form-close-icon:hover {
    opacity: 0.8;
    transform: scale(1.05);
}

.sf-form-close-icon:active {
    transform: scale(0.95);
}

/* Mobile: smaller icon */
@media (max-width: 480px) {
    .sf-form-close-icon {
        width: 28px;
        height: 28px;
    }

    .sf-form-close-icon svg {
        width: 28px;
        height: 28px;
    }
}

/* =============================================================================
   NEW UNIQUE FORM PROGRESS BAR - BEM naming to avoid conflicts with global.css
   ============================================================================= */

.sf-form-progress {
    flex: 1;
    margin: 0;
    padding-top: 6px;
    text-align: center;
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.sf-form-progress__track {
    width: 100%;
    height: 8px;
    background: linear-gradient(90deg, #e5e7eb 0%, #f3f4f6 100%);
    border-radius: 999px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    display: block !important;
    opacity: 1 !important;
}

.sf-form-progress__fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--sf-black) 0%, #1e293b 50%, var(--sf-black) 100%);
    border-radius: 999px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(15, 23, 42, 0.3);
    position: relative;
    overflow: hidden;
    display: block !important;
    opacity: 1 !important;
}

.sf-form-progress__fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(254, 224, 0, 0.3) 50%, transparent 100%);
    animation: sf-form-progress-shimmer 2s ease-in-out infinite;
}

@keyframes sf-form-progress-shimmer {
    0% {
        transform: translateX(-100%);
    }

    100% {
        transform: translateX(100%);
    }
}

.sf-form-progress__steps {
    display: flex !important;
    justify-content: space-between;
    margin-top: 16px;
    gap: 4px;
    position: relative;
    opacity: 1 !important;
    visibility: visible !important;
}

/* Progress line connecting steps */
.sf-form-progress__steps::before {
    content: '';
    position: absolute;
    top: 16px;
    left: 5%;
    right: 5%;
    height: 3px;
    background: linear-gradient(90deg, #e5e7eb 0%, #d1d5db 100%);
    border-radius: 999px;
    z-index: 0;
}

.sf-form-progress__step {
    display: flex !important;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    background: transparent;
    border: none;
    padding: 4px 8px;
    cursor: pointer;
    border-radius: 12px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    flex: 1;
    min-width: 0;
    position: relative;
    z-index: 1;
    opacity: 1 !important;
    visibility: visible !important;
}

.sf-form-progress__step:hover:not(:disabled) {
    background: linear-gradient(135deg, rgba(254, 224, 0, 0.1) 0%, rgba(15, 23, 42, 0.05) 100%);
    transform: translateY(-2px);
}

.sf-form-progress__step:disabled {
    cursor: not-allowed;
    opacity: 0.5 !important;
}

.sf-form-progress__number {
    width: 36px;
    height: 36px;
    /* Issue 2: Ensure perfect circles on mobile */
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
    border: 3px solid #d1d5db;
    display: flex !important;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.95rem;
    color: #6b7280;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    position: relative;
    opacity: 1 !important;
    visibility: visible !important;
    /* Issue 2: Ensure perfect circles, not ovals */
    aspect-ratio: 1 / 1;
    min-width: 36px;
    min-height: 36px;
    max-width: 36px;
    max-height: 36px;
}

.sf-form-progress__number::before {
    content: attr(data-step-num);
}

.sf-form-progress__label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #6b7280;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    transition: all 0.3s ease;
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
}

/* Completed steps (checkmark with green gradient) */
.sf-form-progress__step.sf-form-progress__step--completed .sf-form-progress__number {
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%) !important;
    border-color: #16a34a !important;
    color: #fff !important;
    box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4) !important;
    animation: sf-form-progress-pulse 0.5s ease-out;
}

@keyframes sf-form-progress-pulse {
    0% {
        transform: scale(1);
    }

    50% {
        transform: scale(1.15);
    }

    100% {
        transform: scale(1);
    }
}

.sf-form-progress__step.sf-form-progress__step--completed .sf-form-progress__number::before {
    content: '✓' !important;
    font-size: 1rem;
    font-weight: bold;
}

.sf-form-progress__step.sf-form-progress__step--completed .sf-form-progress__label {
    color: #16a34a !important;
    font-weight: 700;
}

.sf-form-progress__step.sf-form-progress__step--completed:hover:not(:disabled) .sf-form-progress__number {
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 6px 16px rgba(34, 197, 94, 0.5) !important;
}

/* Active step (black with yellow accent) */
.sf-form-progress__step.sf-form-progress__step--active .sf-form-progress__number {
    background: linear-gradient(135deg, var(--sf-black) 0%, #1e293b 100%) !important;
    border-color: var(--sf-black) !important;
    color: #fff !important;
    transform: scale(1.15);
    box-shadow: 0 6px 16px rgba(15, 23, 42, 0.5), 0 0 0 3px rgba(254, 224, 0, 0.3) !important;
    animation: sf-form-progress-glow 2s ease-in-out infinite;
}

@keyframes sf-form-progress-glow {

    0%,
    100% {
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.5), 0 0 0 3px rgba(254, 224, 0, 0.3);
    }

    50% {
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.5), 0 0 0 5px rgba(254, 224, 0, 0.5);
    }
}

.sf-form-progress__step.sf-form-progress__step--active .sf-form-progress__label {
    color: var(--sf-black) !important;
    font-weight: 800;
    text-shadow: 0 1px 2px rgba(254, 224, 0, 0.2);
}

.sf-form-progress__step.sf-form-progress__step--active:hover .sf-form-progress__number {
    transform: scale(1.15);
}

/* Accessible (can navigate to) */
.sf-form-progress__step.sf-form-progress__step--accessible:not(.sf-form-progress__step--active):not(.sf-form-progress__step--completed) .sf-form-progress__number {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%) !important;
    border-color: #3b82f6 !important;
    color: #3b82f6 !important;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2) !important;
}

.sf-form-progress__step.sf-form-progress__step--accessible:not(.sf-form-progress__step--active):not(.sf-form-progress__step--completed):hover .sf-form-progress__number {
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%) !important;
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
}

.sf-form-progress__step.sf-form-progress__step--accessible:not(.sf-form-progress__step--active):not(.sf-form-progress__step--completed) .sf-form-progress__label {
    color: #3b82f6 !important;
}

/* Locked (cannot navigate yet) */
.sf-form-progress__step.sf-form-progress__step--locked {
    cursor: not-allowed !important;
}

.sf-form-progress__step.sf-form-progress__step--locked .sf-form-progress__number {
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%) !important;
    border-color: #e5e7eb !important;
    color: #9ca3af !important;
    box-shadow: none !important;
}

.sf-form-progress__step.sf-form-progress__step--locked .sf-form-progress__label {
    color: #9ca3af !important;
}

.sf-form-progress__step.sf-form-progress__step--locked:hover {
    background: transparent !important;
    transform: none !important;
}

/* Focus state with yellow outline */
.sf-form-progress__step:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px rgba(254, 224, 0, 0.6);
    background: linear-gradient(135deg, rgba(254, 224, 0, 0.1) 0%, rgba(15, 23, 42, 0.05) 100%);
}

/* ===== MOBILE PROGRESS STYLES ===== */
@media (max-width: 768px) {
    .sf-form-progress {
        position: fixed !important;
        top: var(--sf-nav-height-mobile) !important;
        /* Exactly below nav */
        left: 0 !important;
        right: 0 !important;
        z-index: 1000 !important;
        background: #0f172a !important;
        /* Solid background matching nav to prevent overlapping header */
        margin: 0 !important;
        padding: 12px 16px !important;
        border-bottom: none !important;
        box-shadow: none !important;
        transform: none !important;
        /* Remove translateY */
    }

    .sf-form-progress__steps {
        gap: 2px;
        margin-top: 10px;
        /* Reduced for slimmer look */
    }

    .sf-form-progress__steps::before {
        top: 0px;
        left: 8%;
        right: 8%;
        height: 2px;
        background: none;
    }

    .sf-form-progress__step {
        padding: 4px 2px;
        /* Issue 2: Ensure step container doesn't stretch */
        flex: 0 0 auto;
    }

    .sf-form-progress__number {
        width: 30px;
        height: 30px;
        /* Issue 2: Enforce perfect circle on mobile */
        aspect-ratio: 1 / 1;
        min-width: 30px;
        min-height: 30px;
        font-size: 12px;
        border-width: 2px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    }

    .sf-form-progress__label {
        font-size: 0.6rem;
        display: none !important;
        /* Hide labels on mobile */
    }

    .sf-form-progress__step.sf-form-progress__step--active .sf-form-progress__number {
        transform: scale(1.1);
    }

    .sf-form-progress__step:hover:not(:disabled) {
        transform: translateY(-1px);
    }

    /* Hide progress track line on mobile */
    .sf-form-progress__track,
    .sf-progress-track {
        display: none !important;
    }
}

@media (max-width: 480px) {
    .sf-form-progress {
        top: var(--sf-nav-height-small) !important;
        /* Exactly below nav */
        padding: 10px 12px !important;
        /* Slightly less padding on smaller screens */
    }

    .sf-form-progress__steps {
        margin-top: 0px;
    }

    .sf-form-progress__steps::before {
        left: 10%;
        right: 10%;
        height: 2px;
        top: 10px;
        background: none;
    }

    .sf-form-progress__number {
        width: 28px;
        height: 28px;
        /* Issue 2: Enforce perfect circle on small screens */
        aspect-ratio: 1 / 1;
        min-width: 28px;
        min-height: 28px;
        font-size: 11px;
    }

    .sf-form-progress__step.sf-form-progress__step--active .sf-form-progress__number {
        transform: scale(1.05);
    }

    .sf-form-progress__step.sf-form-progress__step--completed .sf-form-progress__number::before {
        font-size: 0.85rem;
    }
}

/* =============================================================================
   RESPONSIIVISUUSPARANNUKSET - Lisätty tukemaan paremmin mobiilia, tablettia ja PWA:ta
   ============================================================================= */

/* 3.1 Päivämääräkentän parannukset mobiilille */
@media (max-width: 768px) {

    /* Isompi touch-alue päivämääräkentälle */
    input[type="datetime-local"],
    input[type="date"] {
        min-height: 52px;
        font-size: 16px;
        /* Estää iOS zoomauksen */
        padding: 14px 44px 14px 14px;
    }

    /* Kalenterikuvake näkyvämmäksi */
    .sf-field:has(input[type="datetime-local"])::after,
    .sf-field:has(input[type="date"])::after {
        width: 24px;
        height: 24px;
        opacity: 0.8;
        right: 12px;
    }
}

/* iOS-tuki: estä autozoom inputteihin */
@supports (-webkit-touch-callout: none) {

    input,
    select,
    textarea {
        font-size: 16px !important;
    }
}

/* 3.2 Select-kentän parannukset */
@media (max-width: 768px) {
    .sf-select {
        min-height: 52px;
        font-size: 16px;
        padding: 14px 44px 14px 14px;
        border-radius: 10px;
    }
}

/* 3.3 PWA ja Safe Area -tuki iOS:lle */
:root {
    --safe-area-inset-top: env(safe-area-inset-top, 0px);
    --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
    --safe-area-inset-left: env(safe-area-inset-left, 0px);
    --safe-area-inset-right: env(safe-area-inset-right, 0px);
}

/* Body tukemaan safe-areas */
body.form-page {
    padding-top: var(--safe-area-inset-top);
    padding-bottom: var(--safe-area-inset-bottom);
    padding-left: var(--safe-area-inset-left);
    padding-right: var(--safe-area-inset-right);
}

@media (max-width: 768px) {

    /* Progress bar huomioi notchin */
    .sf-form-progress {
        top: calc(var(--sf-nav-height-mobile) + var(--safe-area-inset-top, 0px)) !important;
        padding-left: calc(16px + var(--safe-area-inset-left, 0px));
        padding-right: calc(16px + var(--safe-area-inset-right, 0px));
    }

    /* Toimintopainikkeet huomioivat home-indikaattorin */
    .sf-step-actions,
    .sf-step-actions-bottom {
        bottom: calc(var(--sf-footer-height-mobile) + var(--safe-area-inset-bottom, 0px));
        padding-left: var(--safe-area-inset-left, 0px);
        padding-right: var(--safe-area-inset-right, 0px);
    }

    /* Footer safe-area */
    .sf-footer {
        padding-bottom: calc(16px + var(--safe-area-inset-bottom, 0px));
    }
}

/* Standalone (PWA) -tila */
@media (display-mode: standalone) {
    .sf-form-progress {
        top: calc(var(--safe-area-inset-top, 44px) + 10px) !important;
    }

    body.form-page {
        min-height: 100vh;
        min-height: -webkit-fill-available;
    }
}

/* 3.4 Tablet-spesifiset parannukset (768px - 1024px) */
@media (min-width: 769px) and (max-width: 1024px) {
    .sf-form {
        max-width: 90%;
        margin: 20px auto;
        padding: 28px;
    }

    .sf-field-row {
        gap: 20px;
    }

    .sf-field {
        flex: 1 1 calc(50% - 10px);
        min-width: calc(50% - 10px);
    }

    /* Tyyppi-valinta 3 saraketta */
    .sf-type-selection {
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
    }

    .sf-type-box {
        padding: 14px;
        min-height: 80px;
    }

    /* Progress bar labelit näkyviin tabletilla */
    .sf-form-progress__label {
        display: block;
        font-size: 10px;
    }
}

/* 3.5 Touch-interaktioiden parantaminen */
@media (hover: none) and (pointer: coarse) {

    /* Poista hover-efektit kosketusnäytöiltä */
    .sf-btn:hover,
    .sf-type-box:hover,
    .sf-upload-preview:hover {
        transform: none;
    }

    /* Active-tilat kosketukselle */
    .sf-btn:active {
        transform: scale(0.98);
        opacity: 0.9;
    }

    .sf-type-box:active {
        transform: scale(0.99);
    }

    /* Suuremmat touch-alueet */
    .sf-btn {
        min-height: 48px;
        min-width: 48px;
    }

    /* Scroll momentum iOS:lle */
    .sf-form {
        -webkit-overflow-scrolling: touch;
    }

    /* Estä tekstin valinta kosketuksella */
    .sf-form-progress__step,
    .sf-type-box,
    .sf-btn {
        -webkit-user-select: none;
        user-select: none;
    }
}

/* 3.6 Kenttärivit mobiilissa täysleveäksi */
@media (max-width: 768px) {
    .sf-field-row {
        flex-direction: column;
        gap: 12px;
    }

    .sf-field {
        flex: 1 1 100%;
        min-width: 100%;
        margin-bottom: 16px;
    }

    /* Labelit selkeämmiksi */
    .sf-label {
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    /* Inputit isommiksi touch-käytössä */
    .sf-input,
    .sf-textarea {
        min-height: 52px;
        font-size: 16px;
        padding: 14px;
        border-radius: 10px;
    }

    .sf-textarea {
        min-height: 100px;
    }
}

/* 3.7 Validointivirheiden näkyvyys mobiilissa */
@media (max-width: 768px) {

    /* Virheellinen kenttä */
    .sf-input:invalid,
    .sf-select:invalid,
    .sf-textarea:invalid,
    .sf-input.error,
    .sf-select.error {
        border-color: #ef4444;
        border-width: 2px;
        background-color: #fef2f2;
    }

    /* Virheviesti kentän alla */
    .sf-field-error {
        color: #dc2626;
        font-size: 13px;
        font-weight: 500;
        margin-top: 6px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .sf-field-error::before {
        content: "⚠";
        font-size: 14px;
    }

    /* Help-teksti virheelliselle kentälle */
    .sf-field:has(:invalid) .sf-help-text {
        color: #dc2626;
    }
}

/* ============================================================================
   SUPERVISOR APPROVAL SECTION
   ============================================================================ */

.sf-approval-section {
    background: #f8f9fa;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    margin: 24px 0;
}

.sf-approval-section .sf-section-title {
    font-size: 18px;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0 12px 0;
}

.sf-approval-section .sf-help-text {
    font-size: 14px;
    color: #6b7280;
    margin: 0 0 16px 0;
    line-height: 1.5;
}

.sf-auto-approvers {
    margin-bottom: 16px;
}

.sf-auto-approvers h4 {
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    margin: 0 0 12px 0;
}

.approver-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    min-height: 40px;
}

.approver-chip {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: #fff;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    padding: 6px 8px 6px 12px;
    font-size: 14px;
    color: #1f2937;
    transition: all 0.2s;
}

.approver-chip:hover {
    border-color: #9ca3af;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.approver-chip .approver-name {
    font-weight: 500;
}

.approver-chip .chip-remove {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border: none;
    background: #f3f4f6;
    color: #6b7280;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    line-height: 1;
    padding: 0;
    transition: all 0.2s;
}

.approver-chip .chip-remove:hover {
    background: #ef4444;
    color: #fff;
}

.no-approvers-message {
    color: #6b7280;
    font-size: 14px;
    font-style: italic;
    margin: 0;
    padding: 8px 0;
}

.error-message {
    color: #dc2626;
    font-size: 14px;
    margin: 0;
    padding: 8px 0;
}

.sf-additional-approvers {
    margin-top: 16px;
}

.sf-additional-approvers summary {
    font-size: 14px;
    font-weight: 500;
    color: #3b82f6;
    cursor: pointer;
    padding: 8px 0;
    list-style: none;
    display: flex;
    align-items: center;
    gap: 6px;
}

.sf-additional-approvers summary::-webkit-details-marker {
    display: none;
}

.sf-additional-approvers summary::before {
    content: "▸";
    display: inline-block;
    transition: transform 0.2s;
}

.sf-additional-approvers[open] summary::before {
    transform: rotate(90deg);
}

.sf-additional-approvers summary:hover {
    color: #2563eb;
}

.approver-dropdown {
    margin-top: 12px;
    max-height: 300px;
    overflow-y: auto;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 8px;
}

.approver-group {
    margin-bottom: 12px;
}

.approver-group:last-child {
    margin-bottom: 0;
}

.approver-group-title {
    font-size: 13px;
    font-weight: 600;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 8px 8px 4px 8px;
    border-bottom: 1px solid #e5e7eb;
    margin-bottom: 4px;
}

.approver-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.15s;
}

.approver-option:hover {
    background: #f3f4f6;
}

.approver-option input[type="checkbox"] {
    width: 18px;
    height: 18px;
    margin: 0;
    cursor: pointer;
}

.approver-option span {
    font-size: 14px;
    color: #374151;
}

/* Status badge for pending supervisor */
.sf-status--pending-supervisor {
    background: #fef3c7;
    color: #92400e;
    border-color: #fbbf24;
}

/* ============================================================================
   MODERN CHIP-STYLE SUPERVISOR SELECTION UI
   ============================================================================ */

/* Supervisor Approval Section */
/* Modern Supervisor Section Container */
.sf-supervisor-section {
    background: #ffffff;
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    border: 1px solid #e5e7eb;
    margin: 16px auto;
    max-width: 768px;
}

.sf-supervisor-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0 16px 0;
}

/* Worksite Supervisors Section */
.sf-supervisor-worksite {
    margin-bottom: 12px;
}

.sf-supervisor-worksite-label {
    font-size: 0.9rem;
    color: #6b7280;
    margin: 0 0 12px 0;
}

.sf-supervisor-worksite-label span {
    font-weight: 600;
    color: #1f2937;
}

/* Chip cards for worksite supervisors */
.sf-supervisor-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 12px;
}

.sf-supervisor-chips-loading {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #6b7280;
    font-size: 0.9rem;
}

.sf-spinner-small {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid #e5e7eb;
    border-top-color: #3b82f6;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.sf-supervisor-chip {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 20px;
    background: #f9fafb;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 140px;
}

.sf-supervisor-chip:hover {
    border-color: #3b82f6;
    background: #eff6ff;
}

.sf-supervisor-chip.selected {
    border-color: #10b981;
    background: #ecfdf5;
}

.sf-supervisor-chip-name {
    font-weight: 600;
    font-size: 0.95rem;
    color: #1f2937;
    margin-bottom: 4px;
}

.sf-supervisor-chip-status {
    font-size: 0.8rem;
    color: #6b7280;
    display: flex;
    align-items: center;
    gap: 4px;
}

.sf-supervisor-chip.selected .sf-supervisor-chip-status {
    color: #10b981;
}

.sf-supervisor-chip-status::before {
    content: '○';
}

.sf-supervisor-chip.selected .sf-supervisor-chip-status::before {
    content: '✓';
}

.sf-supervisor-empty {
    color: #9ca3af;
    font-size: 0.9rem;
    font-style: italic;
    margin: 0;
}

/* Search Section with Divider */
.sf-supervisor-search {
    border-top: 1px solid #e5e7eb;
    padding-top: 12px;
    margin-top: 4px;
}

.sf-supervisor-search-label {
    font-size: 0.9rem;
    color: #6b7280;
    margin: 0 0 12px 0;
}

/* Search input wrapper */
.sf-search-input-wrap {
    position: relative;
    margin-bottom: 12px;
}

.sf-search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    color: #9ca3af;
    pointer-events: none;
}

.sf-search-input {
    width: 100%;
    padding: 9px 14px 9px 44px;
    border: 1px solid #d1d5db;
    border-radius: 10px;
    font-size: 0.9rem;
    transition: border-color 0.2s;
}

.sf-search-input:focus {
    border-color: #3b82f6;
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Search results container */
.sf-supervisor-search-results {
    margin-top: 12px;
}

/* Selected Counter */
.sf-supervisor-counter {
    margin-top: 10px;
    font-size: 0.9rem;
    color: #6b7280;
    padding-top: 8px;
    border-top: 1px solid #e5e7eb;
}

.sf-supervisor-counter span {
    font-weight: 600;
    color: #1f2937;
}

/* Error and no-results messages */
.sf-error-message {
    color: #ef4444;
    font-size: 0.9rem;
    margin: 0;
}

.sf-no-results-message {
    color: #9ca3af;
    font-size: 0.9rem;
    padding: 12px;
    margin: 0;
}

/* Responsive Design */
@media (max-width: 768px) {
    .sf-supervisor-chips {
        flex-direction: column;
    }

    .sf-supervisor-chip {
        width: 100%;
    }
}

/* Clear search button */
.sf-clear-search {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    background: #e2e8f0;
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #64748b;
    font-size: 16px;
    line-height: 1;
    padding: 0;
    transition: background 0.2s;
}

.sf-clear-search:hover {
    background: #cbd5e1;
}

/* Search-first UI: Empty state, results container, and no results */
.sf-supervisor-empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #94a3b8;
}

.sf-supervisor-empty-state svg {
    width: 48px;
    height: 48px;
    margin: 0 auto 16px;
    opacity: 0.5;
}

.sf-supervisor-results {
    display: none;
    /* Hidden until search */
    margin-top: 20px;
}

.sf-supervisor-results.sf-has-results {
    display: block;
}

.sf-supervisor-results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid #e2e8f0;
}

.sf-supervisor-results-header h4 {
    margin: 0;
    color: #1e293b;
    font-size: 1rem;
}

.sf-supervisor-results-count {
    color: #64748b;
    font-size: 0.9rem;
}

.sf-supervisor-results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 12px;
}

.sf-supervisor-no-results {
    text-align: center;
    padding: 40px 20px;
    color: #94a3b8;
}

/* Supervisor Groups */
.sf-supervisor-groups {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.sf-supervisor-group {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    overflow: hidden;
}

.sf-supervisor-group-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    cursor: pointer;
    background: #f8fafc;
    user-select: none;
    transition: background 0.2s;
}

.sf-supervisor-group-header:hover {
    background: #f1f5f9;
}

.sf-supervisor-group[open] .sf-supervisor-group-header {
    border-bottom: 1px solid #e2e8f0;
}

.sf-badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    background: #e0e7ff;
    color: #4338ca;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
}

/* Supervisor Chips */
.sf-supervisor-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding: 16px;
}

.sf-supervisor-chip {
    display: flex;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s;
}

.sf-supervisor-chip input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
}

.sf-chip-content {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 12px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 24px;
    transition: all 0.2s;
}

.sf-supervisor-chip:hover .sf-chip-content {
    background: #f1f5f9;
    border-color: #cbd5e1;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.sf-supervisor-chip input:checked~.sf-chip-content {
    background: #3b82f6;
    border-color: #3b82f6;
    color: white;
}

.sf-chip-avatar {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e0e7ff;
    color: #4338ca;
    border-radius: 50%;
    font-weight: 600;
    font-size: 0.9rem;
}

.sf-supervisor-chip input:checked~.sf-chip-content .sf-chip-avatar {
    background: white;
    color: #3b82f6;
}

.sf-chip-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.sf-chip-name {
    font-weight: 500;
    font-size: 0.9rem;
    line-height: 1.2;
}

.sf-chip-role {
    font-size: 0.75rem;
    opacity: 0.7;
}

.sf-chip-check {
    display: none;
    font-size: 16px;
}

.sf-supervisor-chip input:checked~.sf-chip-content .sf-chip-check {
    display: block;
}

/* Supervisor Summary */
.sf-supervisor-summary {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid #e2e8f0;
    text-align: center;
    color: #64748b;
    font-size: 0.9rem;
    font-weight: 500;
}

/* Hidden class for search filtering */
.sf-supervisor-chip.sf-hidden {
    display: none !important;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .sf-supervisor-approval-section {
        padding: 16px;
        margin: 16px 0;
    }

    .sf-supervisor-chips {
        flex-direction: column;
        padding: 12px;
    }

    .sf-chip-content {
        width: 100%;
    }

    .sf-supervisor-search-input {
        font-size: 16px;
        /* Prevent iOS zoom */
    }
}

/* ===== SELECTED WORKSITE VISUAL HIGHLIGHT ===== */
.sf-selected-worksite {
    background: #dbeafe !important;
    border-bottom-color: #3b82f6 !important;
}

.sf-badge-primary {
    background: #3b82f6 !important;
    color: white !important;
}

/* Show worksite name on chip for non-selected worksites */
.sf-chip-role {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* ============================================================================
   STICKY PREVIEW & RESPONSIVE ENHANCEMENTS
   ============================================================================ */

/* Preview Section (removed sticky to fix overlap issues) */
.sf-preview-section {
    position: relative;
    /* Changed from sticky */
    background: white;
    padding: 20px 0 16px 0;
    margin-bottom: 20px;
}

/* Responsive Grid for Chips */
.sf-supervisor-chips {
    display: grid;
    grid-template-columns: 1fr;
    /* Mobile: 1 column */
    gap: 10px;
    padding: 16px;
}

@media (min-width: 640px) {
    .sf-supervisor-chips {
        grid-template-columns: repeat(2, 1fr);
        /* Tablet: 2 columns */
    }
}

@media (min-width: 1024px) {
    .sf-supervisor-chips {
        grid-template-columns: repeat(3, 1fr);
        /* Desktop: 3 columns */
    }
}

/* Compact group headers with selection count */
.sf-supervisor-group-header strong {
    flex: 1;
    font-size: 0.95rem;
}

.sf-badge-group {
    display: flex;
    gap: 6px;
    align-items: center;
}

.sf-badge-selected {
    background: #22c55e;
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
}

/* ============================================================================
   CONFIRMATION MODAL
   ============================================================================ */

.sf-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.sf-modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
}

.sf-modal-content {
    position: relative;
    background: white;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 500px;
    width: 90%;
    max-height: 85vh;
    overflow-y: auto;
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.sf-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px;
    border-bottom: 1px solid #e2e8f0;
}

.sf-modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    color: #1e293b;
}

.sf-modal-close {
    background: none;
    border: none;
    font-size: 28px;
    color: #94a3b8;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    transition: all 0.2s;
}

.sf-modal-close:hover {
    background: #f1f5f9;
    color: #64748b;
}

.sf-modal-body {
    padding: 24px;
}

.sf-modal-footer {
    display: flex;
    gap: 12px;
    padding: 16px 24px;
    border-top: 1px solid #e2e8f0;
    justify-content: flex-end;
}

/* Send Flow Visualization */
.sf-send-flow {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 16px 0;
    padding: 12px;
    background: #eff6ff;
    border-radius: 8px;
    overflow-x: auto;
}

.sf-flow-step {
    padding: 8px 12px;
    background: #dbeafe;
    color: #1e40af;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 500;
    white-space: nowrap;
}

.sf-flow-arrow {
    color: #60a5fa;
    font-weight: bold;
}

/* Supervisor Summary in Modal */
.sf-selected-supervisors {
    background: #f8fafc;
    padding: 16px;
    border-radius: 8px;
    margin: 16px 0;
}

.sf-supervisor-summary-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    margin: 4px 0;
    background: white;
    border-radius: 6px;
}

.sf-supervisor-summary-item::before {
    content: '✓';
    color: #22c55e;
    font-weight: bold;
    font-size: 16px;
}

.sf-supervisor-summary-avatar {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e0e7ff;
    color: #4338ca;
    border-radius: 50%;
    font-weight: 600;
    font-size: 0.9rem;
}

.sf-supervisor-summary-info {
    flex: 1;
}

.sf-supervisor-summary-name {
    font-weight: 500;
    color: #1e293b;
}

.sf-supervisor-summary-worksite {
    font-size: 0.85rem;
    color: #64748b;
}

/* Mobile Responsive for Modal */
@media (max-width: 640px) {
    .sf-preview-section {
        top: 10px;
        padding: 12px 0;
    }



    .sf-supervisor-approval-section {
        padding: 16px;
    }

    .sf-modal-content {
        width: 95%;
        max-height: 90vh;
    }

    .sf-flow-step {
        font-size: 0.75rem;
        padding: 6px 10px;
    }
}

/* ===== SUPERVISOR APPROVAL SECTION - Hide for investigation reports (green type) ===== */
/* Disabled: All types (red, yellow, green) need supervisor approval */
/*
.sf-form.type-green #sfSupervisorApprovalSection {
    display: none !important;
}
*/

/* ===== STANDALONE INVESTIGATION TOGGLE ===== */
.sf-standalone-toggle-wrapper {
    margin: 1rem 0;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.sf-toggle-container {
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.sf-toggle {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 26px;
    flex-shrink: 0;
}

.sf-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
}

.sf-toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #cbd5e1;
    transition: 0.3s;
    border-radius: 26px;
}

.sf-toggle-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

.sf-toggle input:checked+.sf-toggle-slider {
    background-color: #10b981;
}

.sf-toggle input:checked+.sf-toggle-slider:before {
    transform: translateX(22px);
}

.sf-toggle input:focus+.sf-toggle-slider {
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
}

.sf-toggle-labels {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.sf-toggle-label-main {
    font-weight: 500;
    color: #1e293b;
    font-size: 0.95rem;
}

.sf-toggle-label-help {
    font-size: 0.85rem;
    color: #64748b;
}

/* Related flash field hidden when standalone is active */
.sf-standalone-active #sf-related-flash-field {
    display: none;
}

/* ========================================
   MOBILE-FIRST EDGE-TO-EDGE DESIGN
   ======================================== */

/* Mobile form container - edge to edge */
@media (max-width: 768px) {

    /* Remove padding from form on mobile for edge-to-edge design */
    .sf-form {
        padding: 0;
        margin: 0;
        margin-top: var(--sf-form-margin-top-mobile);
    }

    .sf-step-content {
        padding: 1rem;
        padding-bottom: 24px;
    }

    /* Step heading */
    .sf-step-content h2 {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
    }

    /* Language selector - centered with better spacing */
    .sf-lang-options {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .sf-lang-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0.5rem;
        border-radius: 8px;
        border: 2px solid transparent;
        min-width: 60px;
    }

    .sf-lang-box.selected,
    .sf-lang-box:has(input:checked) {
        border-color: #3b82f6;
        background: #eff6ff;
    }

    .sf-lang-box img {
        width: 32px;
        height: 24px;
        margin-bottom: 4px;
    }

    .sf-lang-box span {
        font-size: 0.75rem;
        font-weight: 500;
    }

    /* Type selection cards - edge to edge */
    .sf-type-selection {
        margin-left: -1rem;
        margin-right: -1rem;
        gap: 0;
        grid-template-columns: 1fr;
    }

    .sf-type-box {
        display: flex;
        align-items: center;
        padding: 1rem;
        margin-bottom: 0;
        border-radius: 0;
        border: none;
        border-left: 4px solid;
        cursor: pointer;
        transition: all 0.2s;
        min-height: auto;
    }

    .sf-type-box+.sf-type-box {
        border-top: 1px solid #e5e7eb;
    }

    /* Remove the ::before pseudo-element on mobile since we're using border-left */
    .sf-type-box::before {
        display: none;
    }

    /* Card colors */
    .sf-type-box[data-type="red"] {
        border-left-color: #ef4444;
        background: #fef2f2;
    }

    .sf-type-box[data-type="yellow"] {
        border-left-color: #eab308;
        background: #fefce8;
    }

    .sf-type-box[data-type="green"] {
        border-left-color: #22c55e;
        background: #f0fdf4;
    }

    /* Selected state - full border */
    .sf-type-box.selected,
    .sf-type-box:has(input:checked) {
        border: 2px solid;
        border-left-width: 4px;
    }

    .sf-type-box.selected[data-type="red"],
    .sf-type-box:has(input:checked)[data-type="red"] {
        border-color: #ef4444;
    }

    .sf-type-box.selected[data-type="yellow"],
    .sf-type-box:has(input:checked)[data-type="yellow"] {
        border-color: #eab308;
    }

    .sf-type-box.selected[data-type="green"],
    .sf-type-box:has(input:checked)[data-type="green"] {
        border-color: #22c55e;
    }

    /* Card icon - larger on mobile */
    .sf-type-icon {
        width: 48px;
        height: 48px;
        margin-right: 1rem;
        flex-shrink: 0;
    }

    /* Card content */
    .sf-type-box-content {
        flex: 1;
        padding-left: 0;
    }

    .sf-type-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.25rem;
    }

    .sf-type-text p {
        font-size: 0.875rem;
        color: #6b7280;
    }

    /* Checkmark for selected - positioned on the right */
    .sf-type-checkmark {
        width: 24px;
        height: 24px;
        display: none;
        position: static;
        margin-left: auto;
    }

    .sf-type-box.selected .sf-type-checkmark,
    .sf-type-box:has(input:checked) .sf-type-checkmark {
        display: block;
    }

    /* Fixed bottom button container */
    .sf-step-actions-bottom {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 1rem;
        background: white;
        border-top: 1px solid #e5e7eb;
        z-index: 100;
        margin: 0;
    }

    .sf-step-actions-bottom .sf-btn-primary,
    .sf-step-actions-bottom .sf-next-btn {
        width: 100%;
        padding: 1rem;
        font-size: 1rem;
        font-weight: 600;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
    }

    /* Step progress indicator - compact circles for mobile */
    .sf-form-progress {
        background: #374151;
        padding: 0.75rem 1rem;
    }

    .sf-form-progress__steps {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
    }

    .sf-form-progress__step {
        width: 28px;
        height: 28px;
        min-width: 28px;
        padding: 0;
        border-radius: 50%;
        background: #6b7280;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        font-size: 0.875rem;
        font-weight: 600;
    }

    .sf-form-progress__step.active {
        background: #3b82f6;
    }

    .sf-form-progress__step.completed {
        background: #22c55e;
    }

    /* Hide step labels on mobile - show only numbers */
    .sf-form-progress__label {
        display: none;
    }

    .sf-form-progress__number {
        display: block;
    }
}

/* =============================================================================
   MOBILE UX FIXES - Round 2
   Breakpoint: 640px (matches MOBILE_BREAKPOINT in bootstrap.js)
   ============================================================================= */

@media (max-width: 640px) {

    /* Issue 2: Date picker padding reduction for mobile */
    .sf-field:has(input[type="datetime-local"]),
    .sf-field:has(input[type="date"]) {
        margin-bottom: 12px;
    }

    input[type="datetime-local"],
    input[type="date"] {
        padding: 8px 12px;
        min-height: 42px;
    }

    /* Issue 2: Reduce field padding/margins in Step 2 */
    .sf-step-content[data-step="2"] .sf-field {
        margin-bottom: 14px;
    }

    /* Issue 5: Reduce preview section padding on mobile */
    .sf-preview-section {
        padding-top: 8px !important;
        margin-top: 8px;
    }

    .sf-preview-wrapper {
        margin-top: 0;
        padding-top: 0;
    }

    /* Issue 8: Large gap between progress bar and content on step 6 (preview) */
    .sf-step-content[data-step="6"] {
        padding-top: 0;
        padding-bottom: 8px;
        margin-top: 0;
    }

    /* Reduce spacing before preview header */
    .sf-step-content[data-step="6"] h2 {
        margin-top: 8px;
        margin-bottom: 12px;
    }

    /* Reduce preview section spacing */
    .sf-step-content[data-step="6"] .sf-preview-section {
        margin-top: 0;
        margin-bottom: 8px;
        padding-top: 0;
    }

    /* Issue 3: Camera button appears first on mobile for better UX (touch-friendly) */
    .sf-image-upload-actions {
        display: flex;
        gap: 8px;
    }

    .sf-image-camera-btn {
        order: -1;
    }

    /* Issue 6: Show only icons on mobile for compact design */
    .sf-image-camera-btn span,
    .sf-image-upload-btn span,
    .sf-image-library-btn span,
    .sf-image-edit-inline-btn span {
        display: none;
    }

    /* Adjust button sizing for icon-only display */
    .sf-image-camera-btn,
    .sf-image-upload-btn,
    .sf-image-library-btn,
    .sf-image-edit-inline-btn {
        min-width: 44px;
        padding: 10px 12px;
        justify-content: center;
    }

    /* Issue 6: Image editor modal fullscreen on mobile */
    .sf-edit-modal {
        padding: 0;
    }

    .sf-edit-modal-card {
        border-radius: 0;
        max-height: 100vh;
        height: 100vh;
        width: 100vw;
        max-width: 100vw;
        padding: 16px;
    }

    /* Issue 7: Grid layout selection (step 5) full-width on mobile */
    .sf-grid-options {
        flex-direction: column;
    }

    .sf-grid-card {
        width: 100%;
        min-width: unset;
    }

    .sf-grid-card-thumb {
        width: 100%;
        height: auto;
        aspect-ratio: 16/9;
    }
}

/* ===== CAMERA BUTTON - Mobile and tablet only ===== */
/* Hide on desktop (over 1024px) */
@media (min-width: 1025px) {
    .sf-image-camera-btn {
        display: none !important;
    }
}

/* ===== FORM CLOSE BUTTON (Header) - Mobile only ===== */
/* Close button visible only on mobile view (in header area) */
.sf-form-close-mobile {
    display: none;
}

@media (max-width: 768px) {
    .sf-form-close-mobile {
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        top: 10px;
        right: 60px;
        z-index: 1100;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(107, 114, 128, 0.9);
        border: none;
        cursor: pointer;
        transition: background 0.2s ease, transform 0.15s ease;
        -webkit-tap-highlight-color: transparent;
        text-decoration: none;
    }

    .sf-form-close-mobile:hover,
    .sf-form-close-mobile:active {
        background: rgba(239, 68, 68, 0.9);
        transform: scale(1.05);
    }

    .sf-form-close-mobile svg {
        width: 18px;
        height: 18px;
    }
}

/* ===== ESIKATSELU - MODERNI UI ===== */

/* Wrapper rajoittaa loaderin */
.sf-preview-wrapper {
    position: relative;
    overflow: hidden;
}

/* Painikkeet pysyvät loaderin yläpuolella */
.sf-form-actions,
.sf-step-actions,
.sf-preview-actions {
    position: relative;
    z-index: 20;
}

/* TÄRKEÄ: Esikatselu-kuva TERÄVÄT reunat (infonäyttö kokoruutu) */
.sf-preview-img,
#sfPreviewImage1,
#sfPreviewImage2 {
    border-radius: 0 !important;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
    transition: box-shadow 0.3s ease;
}

.sf-preview-img:hover,
#sfPreviewImage1:hover,
#sfPreviewImage2:hover {
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.18);
}

/* Skeleton TERÄVÄT reunat (vastaa kuvaa) */
.skeleton-preview-box,
.skeleton-preview-image,
.sf-preview-loading .skeleton-preview-box,
.sf-preview-loading .skeleton-preview-image {
    border-radius: 0 !important;
}

/* Shimmer-animaatio skeletonille */
.skeleton-preview-image {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: skeleton-shimmer 1.5s ease-in-out infinite;
}

@keyframes skeleton-shimmer {
    0% {
        background-position: 200% 0;
    }

    100% {
        background-position: -200% 0;
    }
}

/* ===== FONT SIZE SELECTOR ===== */
.sf-font-size-selector {
    margin-bottom: 1rem;
    padding: 0.75rem;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.sf-font-size-selector .sf-label {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 0.85rem;
    color: #64748b;
    font-weight: 500;
}

.sf-font-size-options {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.sf-font-size-option {
    cursor: pointer;
}

.sf-font-size-option input {
    display: none;
}

.sf-font-size-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 48px;
    padding: 0.5rem 0.75rem;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 500;
    color: #475569;
    transition: all 0.15s;
}

.sf-font-size-btn:hover {
    border-color: #94a3b8;
    background: #f1f5f9;
}

.sf-font-size-option.selected .sf-font-size-btn,
.sf-font-size-option:has(input:checked) .sf-font-size-btn {
    border-color: #3b82f6;
    background: #eff6ff;
    color: #1e40af;
}

/* Auto button slightly wider */
.sf-font-size-option[data-size="auto"] .sf-font-size-btn {
    min-width: 56px;
}

/* ===== EDITING WARNING BANNER ===== */
.sf-editing-warning {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border: 2px solid #f59e0b;
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
}

.sf-editing-warning-content {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.sf-editing-warning-icon {
    font-size: 1.5rem;
}

.sf-editing-warning-text {
    flex: 1;
    min-width: 200px;
    font-weight: 500;
    color: #92400e;
}

.sf-editing-warning-actions {
    display: flex;
    gap: 8px;
}

.sf-btn-warning {
    background: #f59e0b;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
}

.sf-btn-warning:hover {
    background: #d97706;
}
/* Image Editor Crop Guide Banner */
.sf-edit-crop-guide {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 10px 14px;
    margin: 0 0 8px 0;
    background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
    border-radius: 12px;
    color: #fff;
    font-size: 13px;
    line-height: 1.45;
    position: relative;
    box-shadow: 0 2px 8px rgba(79, 70, 229, 0.25);
    animation: sfCropGuideIn 0.3s ease-out;
}

.sf-edit-crop-guide.hidden {
    display: none !important;
}

.sf-edit-crop-guide-icon {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
    margin-top: 1px;
    opacity: 0.9;
}

.sf-edit-crop-guide-text {
    flex: 1;
}

.sf-edit-crop-guide-text strong {
    font-weight: 700;
}

.sf-crop-guide-main {
    display: block;
    margin-bottom: 4px;
}

/* Crop guide expandable details */
.sf-crop-guide-details {
    margin-top: 6px;
}

.sf-crop-guide-details summary {
    cursor: pointer;
    font-size: 0.9em;
    opacity: 0.9;
    font-weight: 600;
    list-style: none;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 0;
    transition: opacity 0.2s;
}

.sf-crop-guide-details summary::-webkit-details-marker {
    display: none;
}

.sf-crop-guide-details summary::before {
    content: '▶';
    font-size: 0.7em;
    transition: transform 0.2s;
}

.sf-crop-guide-details[open] summary::before {
    transform: rotate(90deg);
}

.sf-crop-guide-details summary:hover {
    opacity: 1;
}

.sf-crop-guide-details ul {
    margin: 6px 0 0 0;
    padding-left: 18px;
    font-size: 0.92em;
    line-height: 1.5;
    opacity: 0.92;
}

.sf-crop-guide-details ul li {
    margin-bottom: 3px;
}

.sf-crop-guide-details ul li:last-child {
    margin-bottom: 0;
}

.sf-edit-crop-guide-close {
    flex-shrink: 0;
    background: rgba(255,255,255,0.2);
    border: none;
    color: #fff;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 14px;
    line-height: 1;
    transition: background 0.2s;
    margin-top: -2px;
}

.sf-edit-crop-guide-close:hover {
    background: rgba(255,255,255,0.35);
}

@keyframes sfCropGuideIn {
    from { opacity: 0; transform: translateY(-6px); }
    to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
    .sf-edit-crop-guide {
        font-size: 12px;
        padding: 8px 12px;
        gap: 8px;
        border-radius: 10px;
    }
    .sf-crop-guide-details summary {
        font-size: 0.85em;
    }
    .sf-crop-guide-details ul {
        font-size: 0.88em;
    }
}

/* ===== IMAGE EDITOR COMPACT - FULLSCREEN ON MOBILE ===== */
@media (max-width: 768px) {
    /* Make compact editor card fill the whole screen */
    .sf-edit-modal-card.sf-edit-compact {
        border-radius: 0;
        height: 100vh;
        max-height: 100vh;
        width: 100vw;
        max-width: 100vw;
        padding: 0;
        display: flex;
        flex-direction: column;
    }

    /* Minimize header - hide title, keep action buttons */
    .sf-edit-modal-card.sf-edit-compact .sf-edit-modal-header-compact {
        padding: 6px 12px;
        flex-shrink: 0;
    }

    .sf-edit-modal-card.sf-edit-compact .sf-edit-header-left h2 {
        display: none;
    }

    /* Body fills remaining space as flex column */
    .sf-edit-modal-card.sf-edit-compact .sf-edit-modal-body-compact {
        flex: 1;
        min-height: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* Canvas area grows to fill body */
    .sf-edit-modal-card.sf-edit-compact .sf-edit-canvas-area {
        flex: 1;
        min-height: 0;
    }

    /* Remove max-height constraint on canvas wrap - let it fill canvas area */
    .sf-edit-modal-card.sf-edit-compact .sf-edit-canvas-wrap {
        max-height: none;
        flex: 1;
        min-height: 0;
    }

    /* Sidebar - compact, hide hints to save space */
    .sf-edit-modal-card.sf-edit-compact .sf-edit-sidebar {
        flex-shrink: 0;
    }

    .sf-edit-modal-card.sf-edit-compact .sf-edit-sidebar-title,
    .sf-edit-modal-card.sf-edit-compact .sf-edit-sidebar-hint {
        display: none;
    }

    /* Footer - less padding to save space */
    .sf-edit-modal-card.sf-edit-compact .sf-edit-modal-footer-compact {
        flex-shrink: 0;
        padding: 8px 12px;
    }
}

/* =============================================================================
   FULL-SCREEN FORM EXPERIENCE
   Hides the site navigation and anchors the progress bar at the top of the
   viewport on every device (mobile, tablet, desktop).
   ============================================================================= */

/* Hide the top nav and bottom nav on form pages */
body.form-page .sf-nav {
    display: none !important;
}
body.form-page .sf-bottom-nav {
    display: none !important;
}

/* Reset body padding that was compensating for the sticky nav */
body.form-page {
    padding-top: env(safe-area-inset-top, 0px) !important;
}

/* Progress bar: always fixed at the very top on every screen size */
body.form-page .sf-form-progress {
    position: fixed !important;
    top: env(safe-area-inset-top, 0px) !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 1100 !important;
    background: #0f172a !important;
    margin: 0 !important;
    padding: 10px 16px !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.35) !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    flex: none !important;
}

/* Desktop: wider padding and form margin-top to clear the fixed bar */
@media (min-width: 769px) {
    body.form-page .sf-form-progress {
        padding: 14px 60px 14px 24px !important;
    }
    body.form-page .sf-form {
        margin-top: 100px !important;
    }
    body.form-page .sf-form-progress__label {
        display: block;
        color: #9ca3af;
    }
}

/* Tablet */
@media (min-width: 480px) and (max-width: 768px) {
    body.form-page .sf-form-progress {
        padding: 10px 52px 10px 16px !important;
    }
    body.form-page .sf-form {
        margin-top: 68px !important;
    }
}

/* Mobile */
@media (max-width: 479px) {
    body.form-page .sf-form-progress {
        padding: 8px 48px 8px 12px !important;
    }
    body.form-page .sf-form {
        margin-top: 60px !important;
    }
}

/* ── Close button inside the progress bar ── */
.sf-form-progress {
    position: relative;
}

.sf-form-progress__close {
    position: absolute;
    top: 50%;
    right: 16px;
    transform: translateY(-50%);
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.1);
    border: 1.5px solid rgba(255, 255, 255, 0.22);
    border-radius: 50%;
    color: #fff;
    cursor: pointer;
    transition: background 0.2s ease, border-color 0.2s ease, transform 0.15s ease;
    -webkit-tap-highlight-color: transparent;
    flex-shrink: 0;
}

.sf-form-progress__close:hover,
.sf-form-progress__close:focus-visible {
    background: rgba(239, 68, 68, 0.85);
    border-color: transparent;
    outline: none;
}

.sf-form-progress__close:active {
    transform: translateY(-50%) scale(0.93);
}

.sf-form-progress__close svg {
    width: 15px;
    height: 15px;
    flex-shrink: 0;
}

/* Nudge step buttons away from the close button */
body.form-page .sf-form-progress .sf-form-progress__steps {
    padding-right: 44px;
    margin-top: 0;
}

/* ── Close-confirmation modal ── */
#sfCloseConfirmModal .sf-modal-content {
    max-width: 400px;
}

/* ── Form-language top bar (fixed header replacement) ── */
.sf-form-topbar {
    display: none; /* hidden by default; shown only on form pages */
}

body.form-page .sf-form-topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: fixed !important;
    top: env(safe-area-inset-top, 0px) !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 1100 !important;
    background: #0f172a !important;
    padding: 10px 16px !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.35) !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
}

.sf-form-topbar__title {
    color: #e2e8f0;
    font-size: 0.875rem;
    font-weight: 500;
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding-right: 12px;
}

.sf-form-topbar__title strong {
    color: #fff;
}

body.form-page .sf-form-container.sf-form-language {
    margin-top: 0;
}

body.form-page .sf-translation-preview-wrapper {
    margin-top: 58px;
}

@media (min-width: 769px) {
    body.form-page .sf-form-topbar {
        padding: 14px 24px !important;
    }
    body.form-page .sf-translation-preview-wrapper {
        margin-top: 68px;
    }
}

/* ── Progress track repositioned to the very top edge of the bar ─────────────
   The thin track/fill strip sits flush at the top (position absolute) so there
   is only one visual line above the step circles.  The fill colour reflects the
   selected Safetyflash type (red / yellow / green).
   ────────────────────────────────────────────────────────────────────────── */

body.form-page .sf-form-progress__track {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: rgba(255, 255, 255, 0.12);
    border-radius: 0;
    box-shadow: none;
    overflow: hidden;
    display: block !important;
}

body.form-page .sf-form-progress__fill {
    background: rgba(255, 255, 255, 0.35);
    border-radius: 0;
    box-shadow: none;
}

body.form-page .sf-form-progress__fill::after {
    background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.35) 50%, transparent 100%);
}

body.form-page .sf-form-progress.type-red .sf-form-progress__fill {
    background: #ef4444;
}

body.form-page .sf-form-progress.type-yellow .sf-form-progress__fill {
    background: #eab308;
}

body.form-page .sf-form-progress.type-green .sf-form-progress__fill {
    background: #22c55e;
}

/* Remove the horizontal connector line drawn between step circles */
body.form-page .sf-form-progress__steps::before {
    display: none !important;
}

/* ── Step 6: Constrain action buttons to match supervisor section width ── */
@media (min-width: 769px) {
    .sf-step-content[data-step="6"] .sf-step-actions-bottom {
        max-width: 768px;
        margin-left: auto;
        margin-right: auto;
        justify-content: flex-end;
    }

    .sf-step-content[data-step="6"] .sf-step-actions-bottom .sf-btn {
        width: auto;
        padding: 12px 24px;
    }
}

/* ── Type classes: keep dark background only, no static border-top stripe ── */

body.form-page .sf-form-progress.type-red {
    background: #0f172a !important;
    border-top: none !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.35) !important;
}

body.form-page .sf-form-progress.type-yellow {
    background: #0f172a !important;
    border-top: none !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.35) !important;
}

body.form-page .sf-form-progress.type-green {
    background: #0f172a !important;
    border-top: none !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.35) !important;
}

/* ── Issue 1: Remove thick type-colored border-top from the white form when the
   progress bar is visible — the color lives in the progress track only. ── */
body.form-page .sf-form {
    border-top-width: 1px !important;
    border-top-color: #e5e7eb !important;
}

/* ── Issue 2: Give step circles enough breathing room below the 4px track ── */
@media (max-width: 768px) {
    body.form-page .sf-form-progress .sf-form-progress__steps {
        padding-top: 8px;
    }
}

/* ── Issue 3: Step circle colors for dark-background progress bar ─────────────
   On body.form-page the progress bar sits on a dark #0f172a background, so the
   default light-grey and blue circles for locked / accessible steps look wrong.
   Override them to semi-transparent dark tones with light text.
   ────────────────────────────────────────────────────────────────────────── */
body.form-page .sf-form-progress__number {
    background: rgba(255, 255, 255, 0.1) !important;
    border-color: rgba(255, 255, 255, 0.25) !important;
    color: rgba(255, 255, 255, 0.6) !important;
    box-shadow: none !important;
}

body.form-page .sf-form-progress__step.sf-form-progress__step--locked .sf-form-progress__number {
    background: transparent !important;
    border: 2px solid #4b5563 !important;
    color: #d1d5db !important;
    box-shadow: none !important;
}

body.form-page .sf-form-progress__step.sf-form-progress__step--locked .sf-form-progress__label {
    color: #9ca3af !important;
}

body.form-page .sf-form-progress__step.sf-form-progress__step--accessible:not(.sf-form-progress__step--active):not(.sf-form-progress__step--completed) .sf-form-progress__number {
    background: rgba(255, 255, 255, 0.12) !important;
    border-color: rgba(255, 255, 255, 0.35) !important;
    color: rgba(255, 255, 255, 0.75) !important;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3) !important;
}

body.form-page .sf-form-progress__step.sf-form-progress__step--accessible:not(.sf-form-progress__step--active):not(.sf-form-progress__step--completed) .sf-form-progress__label {
    color: rgba(255, 255, 255, 0.6) !important;
}

/* ── Dark-theme label colour overrides ──────────────────────────────────────
   The default stylesheet sets label colours for a light background.  On the
   fixed dark (#0f172a) progress bar every label must be visible against the
   dark backdrop, so we re-declare them here with !important.
   ──────────────────────────────────────────────────────────────────────── */

/* Base: all step labels → muted light grey */
body.form-page .sf-form-progress__label {
    color: #9ca3af !important;
}

/* Active step → bright white */
body.form-page .sf-form-progress__step.sf-form-progress__step--active .sf-form-progress__label {
    color: #ffffff !important;
    font-weight: 600 !important;
}

/* Completed step → light grey (not green, which disappears on dark bg) */
body.form-page .sf-form-progress__step.sf-form-progress__step--completed .sf-form-progress__label {
    color: #d1d5db !important;
}
